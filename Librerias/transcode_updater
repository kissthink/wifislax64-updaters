#!/bin/sh

# Script by www.seguridadwireless.net

SCRIPT_VERSION=20170318

############################################################
## Funciones comunes. Su nombre empieza por f_ ##
############################################################
f_variables(){
	. /opt/wifislax-updaters/Funciones/funciones_updater
}

############################################################
## Funciones propias del script. Su nombre empieza por F_ ##
############################################################
# Definicion de variables
F_variables() {
	PRGNAM=transcode
	echo -ne "\033]2;${PRGNAM}_updater\007"
	WEB=https://bitbucket.org/france/transcode-tcforge/downloads/
	VERSION=`curl -s $WEB|grep .bz2|head -1|cut -d- -f 3|cut -d t -f1|sed "s/.$//g"`
	EXTENSION=tar.bz2
	SOURCES=$PRGNAM-$VERSION.$EXTENSION
	DOWNLOAD=https://bitbucket.org/france/transcode-tcforge/downloads/$SOURCES
}

# Comprobar dependencias
F_dependencias(){
DEPENDENCIAS="ffmpeg faac lame libdv libmpeg2 mjpegtools libquicktime x264 xvidcore"
f_dependencias
}

# Descomprimimos el fichero descargado y compilamos
F_compilar(){
echo 
echo "$VERDE"Aplicando parches ..."$CIERRE"
sleep 1

echo "
Rml4IGludmFsaWQgZnJlZSB3aGVuIHByZXNldCBmaWxlIG5vdCBmb3VuZApodHRwczovL2J1Z3Mu
Z2VudG9vLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MzIyOTQ1CkF1dGhvcjogQnJlbm5hbiBTaGFja2xl
dHQKCmRpZmYgLXVyTiB0cmFuc2NvZGUtMS4xLjctb3JpZy9leHBvcnQvZXhwb3J0X2ZmbXBlZy5j
IHRyYW5zY29kZS0xLjEuNy9leHBvcnQvZXhwb3J0X2ZmbXBlZy5jCi0tLSB0cmFuc2NvZGUtMS4x
Ljctb3JpZy9leHBvcnQvZXhwb3J0X2ZmbXBlZy5jCTIwMTEtMTEtMTkgMDg6NTA6MjcuMDAwMDAw
MDAwIC0wODAwCisrKyB0cmFuc2NvZGUtMS4xLjcvZXhwb3J0L2V4cG9ydF9mZm1wZWcuYwkyMDEy
LTA3LTAzIDIwOjA3OjA1LjY2OTA4Mzk0NSAtMDcwMApAQCAtMzIxLDcgKzMyMSw3IEBACiAgICAg
fQogCiAgICAgaWYoIWYpewotICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIkZpbGUgZm9yIHByZXNl
dCAnJXMnIG5vdCBmb3VuZFxuIiwgYXJnKTsKKyAgICAgICAgdGNfbG9nX2Vycm9yKE1PRF9OQU1F
LCAiRmlsZSBmb3IgcHJlc2V0ICclcycgbm90IGZvdW5kIiwgYXJnKTsKICAgICAgICAgYXZfZXhp
dCgxKTsKICAgICB9CiAKQEAgLTEyMDcsNyArMTIwNyw3IEBACiAJLyogRklYTUU6IHRyYW5zY29k
ZSBpdHNlbGYgY29udGFpbnMgImJyb2tlbiBmZm1wZWcgZGVmYXVsdCBzZXR0aW5ncyIsIHRodXMg
d2UgbmVlZCB0byBvdmVycmlkZSB0aGVtISAqLwogCWlmIChsYXZjX3BhcmFtX3ZpZGVvX3ByZXNl
dCkgewogCQlhdmNvZGVjX29wdHNbQVZNRURJQV9UWVBFX1ZJREVPXSA9IGxhdmNfdmVuY19jb250
ZXh0OwotCQl2aWRlb19jb2RlY19uYW1lID0gZmZtcGVnX2NvZGVjX25hbWUoY29kZWMtPm5hbWUp
OworCQl2aWRlb19jb2RlY19uYW1lID0gYXZfc3RyZHVwKGZmbXBlZ19jb2RlY19uYW1lKGNvZGVj
LT5uYW1lKSk7CiAKIAkJY29uc3QgY2hhciAqcHJlc2V0X3N0YXJ0ID0gbGF2Y19wYXJhbV92aWRl
b19wcmVzZXQ7CiAJCXdoaWxlIChwcmVzZXRfc3RhcnQpIHsKQEAgLTEyMjUsNiArMTIyNSw4IEBA
CiAJCQlpZiAob3B0X3ByZXNldCgidnByZSIsIHByZXNldF9uYW1lKSAhPSAwKSB7CiAJCQkJdGNf
bG9nX3dhcm4oTU9EX05BTUUsICJQYXJzaW5nIGZmbXBlZyBwcmVzZXQgJyVzJyBmYWlsZWQiLCBw
cmVzZXRfbmFtZSk7CiAJCQl9CisgICAgICBhdl9mcmVlKHZpZGVvX2NvZGVjX25hbWUpOworICAg
ICAgdmlkZW9fY29kZWNfbmFtZSA9IE5VTEw7CiAJCQlpZiAodmVyYm9zZSkgewogCQkJCWludCBp
OwogCQkJCXRjX2xvZ19pbmZvKE1PRF9OQU1FLCAiQWZ0ZXIgcGFyc2luZyBwcmVzZXQgJyVzJywg
JWkgb3B0aW9ucyBhcmUgb3ZlcnJpZGRlbjoiLCBwcmVzZXRfbmFtZSwgb3B0X25hbWVfY291bnQp
Owo=
" | base64 -d > $TMP/transcode-1.1.7-preset-free.patch
patch -p1 -i $TMP/transcode-1.1.7-preset-free.patch || exit 1

echo "U3VibWl0dGVkIEJ5OiAgICAgICAgICAgIEFybWlvbiBLLiA8a3JlanppIGF0IGVtYWlsIGRvdCBj
b20+CkRhdGU6ICAgICAgICAgICAgICAgICAgICAyMDE2LTA1LTA2CkluaXRpYWwgUGFja2FnZSBW
ZXJzaW9uOiAxLjEuNwpVcHN0cmVhbSBTdGF0dXM6ICAgICAgICAgVW5rbm93bgpPcmlnaW46ICAg
ICAgICAgICAgICAgICAgR2VudG9vIGFuZCBEZWJpYW4KRGVzY3JpcHRpb246ICAgICAgICAgICAg
IEZpeGVzIGJ1aWxkaW5nIGFnYWluc3QgRkZtcGVnIHZlcnNpb24gPj0gMy4wLjAKCi0tLSBhL2Vu
Y29kZS9lbmNvZGVfbGF2Yy5jCTIwMTEtMTEtMTkgMTc6NTA6MjcuMDAwMDAwMDAwICswMTAwCisr
KyBiL2VuY29kZS9lbmNvZGVfbGF2Yy5jCTIwMTYtMDItMTUgMTY6MDg6MzcuOTE0NDg4MTE2ICsw
MTAwCkBAIC03NCw2ICs3NCw5IEBACiAgICAgaW50IGxtaW47CiAgICAgaW50IGxtYXg7CiAgICAg
aW50IG1lX21ldGhvZDsKKyAgICBpbnQgbHVtYV9lbGltX3RocmVzaG9sZDsKKyAgICBpbnQgY2hy
b21hX2VsaW1fdGhyZXNob2xkOworICAgIGludCBxdWFudGl6ZXJfbm9pc2Vfc2hhcGluZzsKIAog
ICAgIC8qIHNhbWUgYXMgYWJvdmUgZm9yIGZsYWdzICovCiAgICAgc3RydWN0IHsKQEAgLTExNCw2
ICsxMTcsNyBAQAogCiAgICAgQVZGcmFtZSBmZl92ZW5jX2ZyYW1lOwogICAgIEFWQ29kZWNDb250
ZXh0IGZmX3Zjb250ZXh0OworICAgIEFWRGljdGlvbmFyeSAqIGZmX29wdHM7CiAKICAgICBBVkNv
ZGVjICpmZl92Y29kZWM7CiAKQEAgLTE2NCw2ICsxNjgsNyBAQAogICAgIFRDX0NPREVDX0VSUk9S
CiB9OwogCisjaWYgTElCQVZDT0RFQ19WRVJTSU9OX01BSk9SIDwgNTUKIHN0YXRpYyBjb25zdCBl
bnVtIENvZGVjSUQgdGNfbGF2Y19pbnRlcm5hbF9jb2RlY3NbXSA9IHsKICAgICBDT0RFQ19JRF9N
UEVHMVZJREVPLCBDT0RFQ19JRF9NUEVHMlZJREVPLCBDT0RFQ19JRF9NUEVHNCwKICAgICBDT0RF
Q19JRF9IMjYzSSwgQ09ERUNfSURfSDI2M1AsCkBAIC0xNzYsNiArMTgxLDIwIEBACiAgICAgQ09E
RUNfSURfTVNNUEVHNFYyLCBDT0RFQ19JRF9NU01QRUc0VjMsCiAgICAgQ09ERUNfSURfTk9ORQog
fTsKKyNlbHNlCitzdGF0aWMgY29uc3QgZW51bSBBVkNvZGVjSUQgdGNfbGF2Y19pbnRlcm5hbF9j
b2RlY3NbXSA9IHsKKyAgICBBVl9DT0RFQ19JRF9NUEVHMVZJREVPLCBBVl9DT0RFQ19JRF9NUEVH
MlZJREVPLCBBVl9DT0RFQ19JRF9NUEVHNCwKKyAgICBBVl9DT0RFQ19JRF9IMjYzSSwgQVZfQ09E
RUNfSURfSDI2M1AsCisgICAgQVZfQ09ERUNfSURfSDI2NCwKKyAgICBBVl9DT0RFQ19JRF9XTVYx
LCBBVl9DT0RFQ19JRF9XTVYyLAorICAgIEFWX0NPREVDX0lEX1JWMTAsCisgICAgQVZfQ09ERUNf
SURfSFVGRllVViwgQVZfQ09ERUNfSURfRkZWMSwKKyAgICBBVl9DT0RFQ19JRF9EVlZJREVPLAor
ICAgIEFWX0NPREVDX0lEX01KUEVHLCBBVl9DT0RFQ19JRF9MSlBFRywKKyAgICBBVl9DT0RFQ19J
RF9NU01QRUc0VjIsIEFWX0NPREVDX0lEX01TTVBFRzRWMywKKyAgICBBVl9DT0RFQ19JRF9OT05F
Cit9OworI2VuZGlmCiAKIHN0YXRpYyBjb25zdCBUQ0Zvcm1hdElEIHRjX2xhdmNfZm9ybWF0c1td
ID0geyBUQ19GT1JNQVRfRVJST1IgfTsKIApAQCAtMjE0LDcgKzIzMyw3IEBACiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdmZyYW1lX2xpc3RfdCAqdmZyYW1lKQogewogICAg
IGF2cGljdHVyZV9maWxsKChBVlBpY3R1cmUgKikmcGQtPmZmX3ZlbmNfZnJhbWUsIHZmcmFtZS0+
dmlkZW9fYnVmLAotICAgICAgICAgICAgICAgICAgICBQSVhfRk1UX1lVVjQyMFAsCisgICAgICAg
ICAgICAgICAgICAgIEFWX1BJWF9GTVRfWVVWNDIwUCwKICAgICAgICAgICAgICAgICAgICAgcGQt
PmZmX3Zjb250ZXh0LndpZHRoLCBwZC0+ZmZfdmNvbnRleHQuaGVpZ2h0KTsKIH0KIApAQCAtMjI4
LDcgKzI0Nyw3IEBACiAgICAgICAgICAgICAgICAgICAgIElNR19ZVVZfREVGQVVMVCwKICAgICAg
ICAgICAgICAgICAgICAgcGQtPmZmX3Zjb250ZXh0LndpZHRoLCBwZC0+ZmZfdmNvbnRleHQuaGVp
Z2h0KTsKICAgICBhdnBpY3R1cmVfZmlsbCgoQVZQaWN0dXJlICopJnBkLT5mZl92ZW5jX2ZyYW1l
LCBwZC0+dmZyYW1lX2J1Zi0+dmlkZW9fYnVmLAotICAgICAgICAgICAgICAgICAgIFBJWF9GTVRf
WVVWNDIyUCwKKyAgICAgICAgICAgICAgICAgICBBVl9QSVhfRk1UX1lVVjQyMlAsCiAgICAgICAg
ICAgICAgICAgICAgcGQtPmZmX3Zjb250ZXh0LndpZHRoLCBwZC0+ZmZfdmNvbnRleHQuaGVpZ2h0
KTsKICAgICBhY19pbWdjb252ZXJ0KHNyYywgSU1HX1lVVl9ERUZBVUxULAogICAgICAgICAgICAg
ICAgICAgcGQtPmZmX3ZlbmNfZnJhbWUuZGF0YSwgSU1HX1lVVjQyMlAsCkBAIC0yNDQsNyArMjYz
LDcgQEAKICAgICAgICAgICAgICAgICAgICAgSU1HX1lVVjQyMlAsCiAgICAgICAgICAgICAgICAg
ICAgIHBkLT5mZl92Y29udGV4dC53aWR0aCwgcGQtPmZmX3Zjb250ZXh0LmhlaWdodCk7CiAgICAg
YXZwaWN0dXJlX2ZpbGwoKEFWUGljdHVyZSAqKSZwZC0+ZmZfdmVuY19mcmFtZSwgcGQtPnZmcmFt
ZV9idWYtPnZpZGVvX2J1ZiwKLSAgICAgICAgICAgICAgICAgICBQSVhfRk1UX1lVVjQyMFAsCisg
ICAgICAgICAgICAgICAgICAgQVZfUElYX0ZNVF9ZVVY0MjBQLAogICAgICAgICAgICAgICAgICAg
IHBkLT5mZl92Y29udGV4dC53aWR0aCwgcGQtPmZmX3Zjb250ZXh0LmhlaWdodCk7CiAgICAgYWNf
aW1nY29udmVydChzcmMsIElNR19ZVVY0MjJQLAogICAgICAgICAgICAgICAgICAgcGQtPmZmX3Zl
bmNfZnJhbWUuZGF0YSwgSU1HX1lVVjQyMFAsCkBAIC0yNTYsNyArMjc1LDcgQEAKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZmcmFtZV9saXN0X3QgKnZmcmFt
ZSkKIHsKICAgICBhdnBpY3R1cmVfZmlsbCgoQVZQaWN0dXJlICopJnBkLT5mZl92ZW5jX2ZyYW1l
LCB2ZnJhbWUtPnZpZGVvX2J1ZiwKLSAgICAgICAgICAgICAgICAgICBQSVhfRk1UX1lVVjQyMlAs
CisgICAgICAgICAgICAgICAgICAgQVZfUElYX0ZNVF9ZVVY0MjJQLAogICAgICAgICAgICAgICAg
ICAgIHBkLT5mZl92Y29udGV4dC53aWR0aCwgcGQtPmZmX3Zjb250ZXh0LmhlaWdodCk7CiAKIH0K
QEAgLTI2Niw3ICsyODUsNyBAQAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2
ZnJhbWVfbGlzdF90ICp2ZnJhbWUpCiB7CiAgICAgYXZwaWN0dXJlX2ZpbGwoKEFWUGljdHVyZSAq
KSZwZC0+ZmZfdmVuY19mcmFtZSwgcGQtPnZmcmFtZV9idWYtPnZpZGVvX2J1ZiwKLSAgICAgICAg
ICAgICAgICAgICBQSVhfRk1UX1lVVjQyMFAsCisgICAgICAgICAgICAgICAgICAgQVZfUElYX0ZN
VF9ZVVY0MjBQLAogICAgICAgICAgICAgICAgICAgIHBkLT5mZl92Y29udGV4dC53aWR0aCwgcGQt
PmZmX3Zjb250ZXh0LmhlaWdodCk7CiAgICAgYWNfaW1nY29udmVydCgmdmZyYW1lLT52aWRlb19i
dWYsIElNR19SR0JfREVGQVVMVCwKICAgICAgICAgICAgICAgICAgIHBkLT5mZl92ZW5jX2ZyYW1l
LmRhdGEsIElNR19ZVVY0MjBQLApAQCAtNTkxLDIxICs2MTAsMjEgQEAKICAgICAgIGNhc2UgQ09E
RUNfWVVWOgogICAgICAgICBpZiAoVENfVkNPREVDX0lEKHBkKSA9PSBUQ19DT0RFQ19IVUZGWVVW
KSB7CiAgICAgICAgICAgICBwZC0+dGNfcGl4X2ZtdCA9IFRDX0NPREVDX1lVVjQyMlA7Ci0gICAg
ICAgICAgICBwZC0+ZmZfdmNvbnRleHQucGl4X2ZtdCA9IFBJWF9GTVRfWVVWNDIyUDsKKyAgICAg
ICAgICAgIHBkLT5mZl92Y29udGV4dC5waXhfZm10ID0gQVZfUElYX0ZNVF9ZVVY0MjJQOwogICAg
ICAgICAgICAgcGQtPnByZV9lbmNvZGVfdmlkZW8gPSBwcmVfZW5jb2RlX3ZpZGVvX3l1djQyMHBf
aHVmZnl1djsKICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIHBkLT50Y19waXhfZm10ID0g
VENfQ09ERUNfWVVWNDIwUDsKICAgICAgICAgICAgIHBkLT5mZl92Y29udGV4dC5waXhfZm10ID0g
KFRDX1ZDT0RFQ19JRChwZCkgPT0gVENfQ09ERUNfTUpQRUcpIAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgPyBQSVhfRk1UX1lVVko0MjBQCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICA6IFBJWF9GTVRfWVVWNDIwUDsKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgID8gQVZfUElYX0ZNVF9ZVVZKNDIwUAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBBVl9QSVhfRk1UX1lVVjQyMFA7CiAgICAg
ICAgICAgICBwZC0+cHJlX2VuY29kZV92aWRlbyA9IHByZV9lbmNvZGVfdmlkZW9feXV2NDIwcDsK
ICAgICAgICAgfQogICAgICAgICBicmVhazsKICAgICAgIGNhc2UgQ09ERUNfWVVWNDIyOgogICAg
ICAgICBwZC0+dGNfcGl4X2ZtdCA9IFRDX0NPREVDX1lVVjQyMlA7CiAgICAgICAgIHBkLT5mZl92
Y29udGV4dC5waXhfZm10ID0gKFRDX1ZDT0RFQ19JRChwZCkgPT0gVENfQ09ERUNfTUpQRUcpIAot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IFBJWF9GTVRfWVVWSjQyMlAKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBQSVhfRk1UX1lVVjQyMlA7CisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gQVZfUElYX0ZNVF9ZVVZKNDIyUAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IEFWX1BJWF9GTVRfWVVWNDIyUDsKICAg
ICAgICAgaWYgKFRDX1ZDT0RFQ19JRChwZCkgPT0gVENfQ09ERUNfSFVGRllVVikgewogICAgICAg
ICAgICAgcGQtPnByZV9lbmNvZGVfdmlkZW8gPSBwcmVfZW5jb2RlX3ZpZGVvX3l1djQyMnBfaHVm
Znl1djsKICAgICAgICAgfSBlbHNlIHsKQEAgLTYxNSwxMCArNjM0LDEwIEBACiAgICAgICBjYXNl
IENPREVDX1JHQjoKICAgICAgICAgcGQtPnRjX3BpeF9mbXQgPSBUQ19DT0RFQ19SR0I7CiAgICAg
ICAgIHBkLT5mZl92Y29udGV4dC5waXhfZm10ID0gKFRDX1ZDT0RFQ19JRChwZCkgPT0gVENfQ09E
RUNfSFVGRllVVikKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IFBJ
WF9GTVRfWVVWNDIyUAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8g
QVZfUElYX0ZNVF9ZVVY0MjJQCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgOiAoVENfVkNPREVDX0lEKHBkKSA9PSBUQ19DT0RFQ19NSlBFRykgCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBQSVhfRk1UX1lVVko0MjBQCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBQSVhfRk1UX1lVVjQyMFA7Cisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBBVl9QSVhfRk1UX1lV
Vko0MjBQCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBBVl9Q
SVhfRk1UX1lVVjQyMFA7CiAgICAgICAgIHBkLT5wcmVfZW5jb2RlX3ZpZGVvID0gcHJlX2VuY29k
ZV92aWRlb19yZ2IyNDsKICAgICAgICAgYnJlYWs7CiAgICAgICBkZWZhdWx0OgpAQCAtOTM3LDcg
Kzk1NiwxMSBAQAogc3RhdGljIHZvaWQgdGNfbGF2Y19jb25maWdfZGVmYXVsdHMoVENMYXZjUHJp
dmF0ZURhdGEgKnBkKQogewogICAgIC8qIGZpcnN0IG9mIGFsbCByZWluaXRpYWxpemUgbGF2YyBk
YXRhICovCisjaWYgTElCQVZDT0RFQ19WRVJTSU9OX01BSk9SIDwgNTUKICAgICBhdmNvZGVjX2dl
dF9jb250ZXh0X2RlZmF1bHRzKCZwZC0+ZmZfdmNvbnRleHQpOworI2Vsc2UKKyAgICBhdmNvZGVj
X2dldF9jb250ZXh0X2RlZmF1bHRzMygmcGQtPmZmX3Zjb250ZXh0LCBOVUxMKTsKKyNlbmRpZgog
CiAgICAgcGQtPmNvbmZkYXRhLnRocmVhZF9jb3VudCA9IDE7CiAKQEAgLTk1NSw4ICs5NzgsNiBA
QAogICAgIC8qIAogICAgICAqIGNvbnRleHQgKnRyYW5zY29kZSogKG5vdCBsaWJhdmNvZGVjKSBk
ZWZhdWx0cwogICAgICAqLwotICAgIHBkLT5mZl92Y29udGV4dC5tYl9xbWluICAgICAgICAgICAg
ICAgICA9IDI7Ci0gICAgcGQtPmZmX3Zjb250ZXh0Lm1iX3FtYXggICAgICAgICAgICAgICAgID0g
MzE7CiAgICAgcGQtPmZmX3Zjb250ZXh0Lm1heF9xZGlmZiAgICAgICAgICAgICAgID0gMzsKICAg
ICBwZC0+ZmZfdmNvbnRleHQubWF4X2JfZnJhbWVzICAgICAgICAgICAgPSAwOwogICAgIHBkLT5m
Zl92Y29udGV4dC5tZV9yYW5nZSAgICAgICAgICAgICAgICA9IDA7CkBAIC05NzcsOCArOTk4LDgg
QEAKICAgICBwZC0+ZmZfdmNvbnRleHQubXBlZ19xdWFudCAgICAgICAgICAgICAgPSAwOwogICAg
IHBkLT5mZl92Y29udGV4dC5yY19pbml0aWFsX2NwbHggICAgICAgICA9IDAuMDsKICAgICBwZC0+
ZmZfdmNvbnRleHQucmNfcXNxdWlzaCAgICAgICAgICAgICAgPSAxLjA7Ci0gICAgcGQtPmZmX3Zj
b250ZXh0Lmx1bWFfZWxpbV90aHJlc2hvbGQgICAgID0gMDsKLSAgICBwZC0+ZmZfdmNvbnRleHQu
Y2hyb21hX2VsaW1fdGhyZXNob2xkICAgPSAwOworICAgIHBkLT5jb25mZGF0YS5sdW1hX2VsaW1f
dGhyZXNob2xkICAgICA9IDA7CisgICAgcGQtPmNvbmZkYXRhLmNocm9tYV9lbGltX3RocmVzaG9s
ZCAgID0gMDsKICAgICBwZC0+ZmZfdmNvbnRleHQuc3RyaWN0X3N0ZF9jb21wbGlhbmNlICAgPSAw
OwogICAgIHBkLT5mZl92Y29udGV4dC5kY3RfYWxnbyAgICAgICAgICAgICAgICA9IEZGX0RDVF9B
VVRPOwogICAgIHBkLT5mZl92Y29udGV4dC5pZGN0X2FsZ28gICAgICAgICAgICAgICA9IEZGX0lE
Q1RfQVVUTzsKQEAgLTEwMDIsNyArMTAyMyw3IEBACiAgICAgcGQtPmZmX3Zjb250ZXh0LmludHJh
X3F1YW50X2JpYXMgICAgICAgID0gRkZfREVGQVVMVF9RVUFOVF9CSUFTOwogICAgIHBkLT5mZl92
Y29udGV4dC5pbnRlcl9xdWFudF9iaWFzICAgICAgICA9IEZGX0RFRkFVTFRfUVVBTlRfQklBUzsK
ICAgICBwZC0+ZmZfdmNvbnRleHQubm9pc2VfcmVkdWN0aW9uICAgICAgICAgPSAwOwotICAgIHBk
LT5mZl92Y29udGV4dC5xdWFudGl6ZXJfbm9pc2Vfc2hhcGluZyA9IDA7CisgICAgcGQtPmNvbmZk
YXRhLnF1YW50aXplcl9ub2lzZV9zaGFwaW5nID0gMDsKICAgICBwZC0+ZmZfdmNvbnRleHQuZmxh
Z3MgICAgICAgICAgICAgICAgICAgPSAwOwogfQogCkBAIC0xMDMzLDE3ICsxMDU0LDEwIEBACiAg
ICAgcGQtPmZmX3Zjb250ZXh0Lm1lX21ldGhvZCA9IE1FX1pFUk8gKyBwZC0+Y29uZmRhdGEubWVf
bWV0aG9kOwogCiAgICAgcGQtPmZmX3Zjb250ZXh0LmZsYWdzID0gMDsKLSAgICBTRVRfRkxBRyhw
ZCwgbXYwKTsKLSAgICBTRVRfRkxBRyhwZCwgY2JwKTsKICAgICBTRVRfRkxBRyhwZCwgcXBlbCk7
Ci0gICAgU0VUX0ZMQUcocGQsIGFsdCk7Ci0gICAgU0VUX0ZMQUcocGQsIHZkcGFydCk7Ci0gICAg
U0VUX0ZMQUcocGQsIG5hcSk7CiAgICAgU0VUX0ZMQUcocGQsIGlsbWUpOwogICAgIFNFVF9GTEFH
KHBkLCBpbGRjdCk7CiAgICAgU0VUX0ZMQUcocGQsIGFpYyk7Ci0gICAgU0VUX0ZMQUcocGQsIGFp
dik7Ci0gICAgU0VUX0ZMQUcocGQsIHVtdik7CiAgICAgU0VUX0ZMQUcocGQsIHBzbnIpOwogICAg
IFNFVF9GTEFHKHBkLCB0cmVsbCk7CiAgICAgU0VUX0ZMQUcocGQsIGdyYXkpOwpAQCAtMTA2NCw2
ICsxMDc4LDM2IEBACiAgICAgICAgIHBkLT5mZl92Y29udGV4dC5mbGFncyB8PSBDT0RFQ19GTEFH
X0lOVEVSTEFDRURfRENUOwogICAgICAgICBwZC0+ZmZfdmNvbnRleHQuZmxhZ3MgfD0gQ09ERUNf
RkxBR19JTlRFUkxBQ0VEX01FOwogICAgIH0KKyAgICBpZiAocGQtPmNvbmZkYXRhLmZsYWdzLmFs
dCkgeworICAgICAgICBhdl9kaWN0X3NldCgmKHBkLT5mZl9vcHRzKSwgImFsdGVybmF0ZV9zY2Fu
IiwgIjEiLCAwKTsKKyAgICB9CisgICAgaWYgKHBkLT5jb25mZGF0YS5mbGFncy52ZHBhcnQpIHsK
KyAgICAgICAgYXZfZGljdF9zZXQoJihwZC0+ZmZfb3B0cyksICJkYXRhX3BhcnRpdGlvbmluZyIs
ICIxIiwgMCk7CisgICAgfQorICAgIGlmIChwZC0+Y29uZmRhdGEuZmxhZ3MudW12KSB7CisgICAg
ICAgIGF2X2RpY3Rfc2V0KCYocGQtPmZmX29wdHMpLCAidW12IiwgIjEiLCAwKTsKKyAgICB9Cisg
ICAgaWYgKHBkLT5jb25mZGF0YS5mbGFncy5haXYpIHsKKyAgICAgICAgYXZfZGljdF9zZXQoJihw
ZC0+ZmZfb3B0cyksICJhaXYiLCAiMSIsIDApOworICAgIH0KKyAgICBpZiAocGQtPmNvbmZkYXRh
LmZsYWdzLmNicCkgeworICAgIAlhdl9kaWN0X3NldCgmKHBkLT5mZl9vcHRzKSwgIm1wdl9mbGFn
cyIsICIrY2JwX3JkIiwgMCk7CisgICAgfQorICAgIGlmIChwZC0+Y29uZmRhdGEuZmxhZ3MubXYw
KSB7CisgICAgICAgIGF2X2RpY3Rfc2V0KCYocGQtPmZmX29wdHMpLCAibXB2X2ZsYWdzIiwgIitt
djAiLCAwKTsKKyAgICB9CisgICAgaWYgKHBkLT5jb25mZGF0YS5mbGFncy5uYXEpIHsKKyAgICAg
ICAgYXZfZGljdF9zZXQoJihwZC0+ZmZfb3B0cyksICJtcHZfZmxhZ3MiLCAiK25hcSIsIDApOwor
ICAgIH0KKworICAgIGNoYXIgYnVmWzEwMjRdOworI2RlZmluZSBzZXRfZGljdF9vcHQodmFsLCBv
cHQpIFwKKyAgICBzbnByaW50ZihidWYsIHNpemVvZihidWYpLCAiJWkiLCBwZC0+Y29uZmRhdGEu
dmFsKTtcCisgICAgYXZfZGljdF9zZXQoJihwZC0+ZmZfb3B0cyksIG9wdCwgYnVmLCAwKQorCisg
ICAgc2V0X2RpY3Rfb3B0KGx1bWFfZWxpbV90aHJlc2hvbGQsICJsdW1hX2VsaW1fdGhyZXNob2xk
Iik7CisgICAgc2V0X2RpY3Rfb3B0KGNocm9tYV9lbGltX3RocmVzaG9sZCwgImNocm9tYV9lbGlt
X3RocmVzaG9sZCIpOworICAgIHNldF9kaWN0X29wdChxdWFudGl6ZXJfbm9pc2Vfc2hhcGluZywg
InF1YW50aXplcl9ub2lzZV9zaGFwaW5nIik7CiB9CiAKICN1bmRlZiBTRVRfRkxBRwpAQCAtMTEx
NiwxMiArMTE2MCwxMCBAQAogICAgICAgICAvLyAgaGFuZGxlZCBieSB0cmFuc2NvZGUgY29yZQog
ICAgICAgICAvLyAgeyAidnFtYXgiLCBQQ1RYKHFtYXgpLCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09O
Rl9GTEFHX1JBTkdFLCAxLCA2MCB9LAogICAgICAgICAvLyAgaGFuZGxlZCBieSB0cmFuc2NvZGUg
Y29yZQotICAgICAgICB7ICJtYnFtaW4iLCBQQ1RYKG1iX3FtaW4pLCBUQ0NPTkZfVFlQRV9JTlQs
IFRDQ09ORl9GTEFHX1JBTkdFLCAxLCA2MCB9LAotICAgICAgICB7ICJtYnFtYXgiLCBQQ1RYKG1i
X3FtYXgpLCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9GTEFHX1JBTkdFLCAxLCA2MCB9LAogICAg
ICAgICB7ICJsbWluIiwgUEFVWChsbWluKSwgVENDT05GX1RZUEVfRkxPQVQsIFRDQ09ORl9GTEFH
X1JBTkdFLCAwLjAxLCAyNTUuMCB9LAogICAgICAgICB7ICJsbWF4IiwgUEFVWChsbWF4KSwgVEND
T05GX1RZUEVfRkxPQVQsIFRDQ09ORl9GTEFHX1JBTkdFLCAwLjAxLCAyNTUuMCB9LAogICAgICAg
ICB7ICJ2cWRpZmYiLCBQQ1RYKG1heF9xZGlmZiksIFRDQ09ORl9UWVBFX0lOVCwgVENDT05GX0ZM
QUdfUkFOR0UsIDEsIDMxIH0sCi0gICAgICAgIHsgInZtYXhfYl9mcmFtZXMiLCBQQ1RYKG1heF9i
X2ZyYW1lcyksIFRDQ09ORl9UWVBFX0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIDAsIEZGX01BWF9C
X0ZSQU1FUyB9LAorICAgICAgICB7ICJ2bWF4X2JfZnJhbWVzIiwgUENUWChtYXhfYl9mcmFtZXMp
LCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9GTEFHX1JBTkdFLCAwLCBJTlRfTUFYIH0sCiAgICAg
ICAgIHsgInZtZSIsIFBBVVgobWVfbWV0aG9kKSwgVENDT05GX1RZUEVfSU5ULCBUQ0NPTkZfRkxB
R19SQU5HRSwgMCwgMTYsIH0sCiAgICAgICAgIHsgIm1lX3JhbmdlIiwgUENUWChtZV9yYW5nZSks
IFRDQ09ORl9UWVBFX0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIDAsIDE2MDAwIH0sCiAgICAgICAg
IHsgIm1iZCIsIFBDVFgobWJfZGVjaXNpb24pLCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9GTEFH
X1JBTkdFLCAwLCAzIH0sCkBAIC0xMTUwLDggKzExOTIsOCBAQAogICAgICAgICB7ICJ2cmNfaW5p
dF9jcGx4IiwgUENUWChyY19pbml0aWFsX2NwbHgpLCBUQ0NPTkZfVFlQRV9GTE9BVCwgVENDT05G
X0ZMQUdfUkFOR0UsIDAuMCwgOTk5OTk5OS4wIH0sCiAgICAgICAgIC8vICB7ICJ2cmNfaW5pdF9v
Y2N1cGFuY3kiLCAgIH0sIC8vIG5vdCB5ZXQgc3VwcG9ydGVkCiAgICAgICAgIHsgInZxc3F1aXNo
IiwgUENUWChyY19xc3F1aXNoKSwgVENDT05GX1RZUEVfRkxPQVQsIFRDQ09ORl9GTEFHX1JBTkdF
LCAwLjAsIDk5LjAgfSwKLSAgICAgICAgeyAidmxlbGltIiwgUENUWChsdW1hX2VsaW1fdGhyZXNo
b2xkKSwgVENDT05GX1RZUEVfSU5ULCBUQ0NPTkZfRkxBR19SQU5HRSwgLTk5LCA5OSB9LAotICAg
ICAgICB7ICJ2Y2VsaW0iLCBQQ1RYKGNocm9tYV9lbGltX3RocmVzaG9sZCksIFRDQ09ORl9UWVBF
X0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIC05OSwgOTkgfSwKKyAgICAgICAgeyAidmxlbGltIiwg
UEFVWChsdW1hX2VsaW1fdGhyZXNob2xkKSwgVENDT05GX1RZUEVfSU5ULCBUQ0NPTkZfRkxBR19S
QU5HRSwgLTk5LCA5OSB9LAorICAgICAgICB7ICJ2Y2VsaW0iLCBQQVVYKGNocm9tYV9lbGltX3Ro
cmVzaG9sZCksIFRDQ09ORl9UWVBFX0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIC05OSwgOTkgfSwK
ICAgICAgICAgeyAidnN0cmljdCIsIFBDVFgoc3RyaWN0X3N0ZF9jb21wbGlhbmNlKSwgVENDT05G
X1RZUEVfSU5ULCBUQ0NPTkZfRkxBR19SQU5HRSwgLTk5LCA5OSB9LAogICAgICAgICB7ICJ2cHNp
emUiLCBQQ1RYKHJ0cF9wYXlsb2FkX3NpemUpLCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9GTEFH
X1JBTkdFLCAwLCAxMDAwMDAwMDAgfSwKICAgICAgICAgeyAiZGN0IiwgUENUWChkY3RfYWxnbyks
IFRDQ09ORl9UWVBFX0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIDAsIDEwIH0sCkBAIC0xMTc3LDI1
ICsxMjE5LDI1IEBACiAgICAgICAgIHsgImliaWFzIiwgUENUWChpbnRyYV9xdWFudF9iaWFzKSwg
VENDT05GX1RZUEVfSU5ULCBUQ0NPTkZfRkxBR19SQU5HRSwgLTUxMiwgNTEyIH0sCiAgICAgICAg
IHsgInBiaWFzIiwgUENUWChpbnRlcl9xdWFudF9iaWFzKSwgVENDT05GX1RZUEVfSU5ULCBUQ0NP
TkZfRkxBR19SQU5HRSwgLTUxMiwgNTEyIH0sCiAgICAgICAgIHsgIm5yIiwgUENUWChub2lzZV9y
ZWR1Y3Rpb24pLCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9GTEFHX1JBTkdFLCAwLCAxMDAwMDAw
fSwKLSAgICAgICAgeyAicW5zIiwgUENUWChxdWFudGl6ZXJfbm9pc2Vfc2hhcGluZyksIFRDQ09O
Rl9UWVBFX0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIDAsIDMgfSwKKyAgICAgICAgeyAicW5zIiwg
UEFVWChxdWFudGl6ZXJfbm9pc2Vfc2hhcGluZyksIFRDQ09ORl9UWVBFX0lOVCwgVENDT05GX0ZM
QUdfUkFOR0UsIDAsIDMgfSwKICAgICAgICAgeyAiaW50ZXJfbWF0cml4X2ZpbGUiLCBpbnRlcl9t
YXRyaXhfZmlsZSwgVENDT05GX1RZUEVfU1RSSU5HLCAwLCAwLCAwIH0sCiAgICAgICAgIHsgImlu
dHJhX21hdHJpeF9maWxlIiwgaW50cmFfbWF0cml4X2ZpbGUsIFRDQ09ORl9UWVBFX1NUUklORywg
MCwgMCwgMCB9LAogICAgIAotICAgICAgICB7ICJtdjAiLCBQQVVYKGZsYWdzLm12MCksIFRDQ09O
Rl9UWVBFX0ZMQUcsIDAsIDAsIENPREVDX0ZMQUdfTVYwIH0sCi0gICAgICAgIHsgImNicCIsIFBB
VVgoZmxhZ3MuY2JwKSwgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNfRkxBR19DQlBfUkQg
fSwKKyAgICAgICAgeyAibXYwIiwgUEFVWChmbGFncy5tdjApLCBUQ0NPTkZfVFlQRV9GTEFHLCAw
LCAwLCAxIH0sCisgICAgICAgIHsgImNicCIsIFBBVVgoZmxhZ3MuY2JwKSwgVENDT05GX1RZUEVf
RkxBRywgMCwgMCwgMSB9LAogICAgICAgICB7ICJxcGVsIiwgUEFVWChmbGFncy5xcGVsKSwgVEND
T05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNfRkxBR19RUEVMIH0sCi0gICAgICAgIHsgImFsdCIs
IFBBVVgoZmxhZ3MuYWx0KSwgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNfRkxBR19BTFRf
U0NBTiB9LAorICAgICAgICB7ICJhbHQiLCBQQVVYKGZsYWdzLmFsdCksIFRDQ09ORl9UWVBFX0ZM
QUcsIDAsIDAsIDEgfSwKICAgICAgICAgeyAiaWxtZSIsIFBBVVgoZmxhZ3MuaWxtZSksIFRDQ09O
Rl9UWVBFX0ZMQUcsIDAsIDAsIENPREVDX0ZMQUdfSU5URVJMQUNFRF9NRSB9LAogICAgICAgICB7
ICJpbGRjdCIsIFBBVVgoZmxhZ3MuaWxkY3QpLCBUQ0NPTkZfVFlQRV9GTEFHLCAwLCAwLCBDT0RF
Q19GTEFHX0lOVEVSTEFDRURfRENUIH0sCi0gICAgICAgIHsgIm5hcSIsIFBBVVgoZmxhZ3MubmFx
KSwgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNfRkxBR19OT1JNQUxJWkVfQVFQIH0sCi0g
ICAgICAgIHsgInZkcGFydCIsIFBBVVgoZmxhZ3MudmRwYXJ0KSwgVENDT05GX1RZUEVfRkxBRywg
MCwgMCwgQ09ERUNfRkxBR19QQVJUIH0sCisgICAgICAgIHsgIm5hcSIsIFBBVVgoZmxhZ3MubmFx
KSwgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgMSB9LAorICAgICAgICB7ICJ2ZHBhcnQiLCBQQVVY
KGZsYWdzLnZkcGFydCksIFRDQ09ORl9UWVBFX0ZMQUcsIDAsIDAsIDEgfSwKICNpZiBMSUJBVkNP
REVDX1ZFUlNJT05fSU5UIDwgKCg1Mjw8MTYpKygwPDw4KSswKQogICAgICAgICB7ICJhaWMiLCBQ
QVVYKGZsYWdzLmFpYyksIFRDQ09ORl9UWVBFX0ZMQUcsIDAsIDAsIENPREVDX0ZMQUdfSDI2M1Bf
QUlDIH0sCiAjZWxzZSAgICAgICAgCiAgICAgICAgIHsgImFpYyIsIFBBVVgoZmxhZ3MuYWljKSwg
VENDT05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNfRkxBR19BQ19QUkVEIH0sCiAjZW5kaWYKLSAg
ICAgICAgeyAiYWl2IiwgUEFVWChmbGFncy5haXYpLCBUQ0NPTkZfVFlQRV9GTEFHLCAwLCAwLCBD
T0RFQ19GTEFHX0gyNjNQX0FJViB9LAotICAgICAgICB7ICJ1bXYiLCBQQVVYKGZsYWdzLnVtdiks
IFRDQ09ORl9UWVBFX0ZMQUcsIDAsIDAsIENPREVDX0ZMQUdfSDI2M1BfVU1WIH0sCisgICAgICAg
IHsgImFpdiIsIFBBVVgoZmxhZ3MuYWl2KSwgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgMSB9LAor
ICAgICAgICB7ICJ1bXYiLCBQQVVYKGZsYWdzLnVtdiksIFRDQ09ORl9UWVBFX0ZMQUcsIDAsIDAs
IDEgfSwKICAgICAgICAgeyAicHNuciIsIFBBVVgoZmxhZ3MucHNuciksIFRDQ09ORl9UWVBFX0ZM
QUcsIDAsIDAsIENPREVDX0ZMQUdfUFNOUiB9LAogI2lmIExJQkFWQ09ERUNfVkVSU0lPTl9JTlQg
PCAoKDUyPDwxNikrKDA8PDgpKzApCiAgICAgICAgIHsgInRyZWxsIiwgUEFVWChmbGFncy50cmVs
bCksIFRDQ09ORl9UWVBFX0ZMQUcsIDAsIDAsIENPREVDX0ZMQUdfVFJFTExJU19RVUFOVCB9LApA
QCAtMTM0NSwxMiArMTM4NywxNCBAQAogCiAgICAgcGQgPSBzZWxmLT51c2VyZGF0YTsKIAorICAg
IHBkLT5mZl9vcHRzID0gTlVMTDsKKwogICAgIHBkLT5mbHVzaF9mbGFnID0gdm9iLT5lbmNvZGVy
X2ZsdXNoOwogICAgIAogICAgIC8qIEZJWE1FOiBtb3ZlIGludG8gY29yZT8gKi8KICAgICBUQ19J
TklUX0xJQkFWQ09ERUM7CiAKLSAgICBhdmNvZGVjX2dldF9mcmFtZV9kZWZhdWx0cygmcGQtPmZm
X3ZlbmNfZnJhbWUpOworICAgIGF2X2ZyYW1lX3VucmVmKCZwZC0+ZmZfdmVuY19mcmFtZSk7CiAg
ICAgLyoKICAgICAgKiBhdXhpbGlhcnkgY29uZmlnIGRhdGEgbmVlZHMgdG8gYmUgYmxhbmtlZCB0
b28KICAgICAgKiBiZWZvcmUgYW55IG90aGVyIG9wZXJhdGlvbgpAQCAtMTM4Nyw3ICsxNDMxLDcg
QEAKICAgICAgICAgICAgICAgICAgICAgcGQtPmNvbmZkYXRhLnRocmVhZF9jb3VudCwKICAgICAg
ICAgICAgICAgICAgICAgKHBkLT5jb25mZGF0YS50aHJlYWRfY291bnQgPiAxKSA/InMiIDoiIik7
CiAgICAgfQotICAgIGF2Y29kZWNfdGhyZWFkX2luaXQoJnBkLT5mZl92Y29udGV4dCwgcGQtPmNv
bmZkYXRhLnRocmVhZF9jb3VudCk7CisgICAgcGQtPmZmX3Zjb250ZXh0LnRocmVhZF9jb3VudCA9
IHBkLT5jb25mZGF0YS50aHJlYWRfY291bnQ7CiAKICAgICBwZC0+ZmZfdmNvZGVjID0gYXZjb2Rl
Y19maW5kX2VuY29kZXIoRkZfVkNPREVDX0lEKHBkKSk7CiAgICAgaWYgKHBkLT5mZl92Y29kZWMg
PT0gTlVMTCkgewpAQCAtMTM5NywxMSArMTQ0MSwxMSBAQAogICAgIH0KIAogICAgIFRDX0xPQ0tf
TElCQVZDT0RFQzsKLSAgICByZXQgPSBhdmNvZGVjX29wZW4oJnBkLT5mZl92Y29udGV4dCwgcGQt
PmZmX3Zjb2RlYyk7CisgICAgcmV0ID0gYXZjb2RlY19vcGVuMigmcGQtPmZmX3Zjb250ZXh0LCBw
ZC0+ZmZfdmNvZGVjLCAmKHBkLT5mZl9vcHRzKSk7CiAgICAgVENfVU5MT0NLX0xJQkFWQ09ERUM7
CiAKICAgICBpZiAocmV0IDwgMCkgewotICAgICAgICB0Y19sb2dfZXJyb3IoTU9EX05BTUUsICJh
dmNvZGVjX29wZW4oKSBmYWlsZWQiKTsKKyAgICAgICAgdGNfbG9nX2Vycm9yKE1PRF9OQU1FLCAi
YXZjb2RlY19vcGVuMigpIGZhaWxlZCIpOwogICAgICAgICBnb3RvIGZhaWxlZDsKICAgICB9CiAg
ICAgLyogZmluYWxseSwgcGFzcyB1cCB0aGUgZXh0cmFkYXRhLCBpZiBhbnkgKi8KQEAgLTE0ODMs
NiArMTUyNyw4IEBACiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZmcmFtZV9saXN0
X3QgKm91dGZyYW1lKQogewogICAgIFRDTGF2Y1ByaXZhdGVEYXRhICpwZCA9IE5VTEw7CisgICAg
QVZQYWNrZXQgcGt0OworICAgIGludCByZXQsIGdvdF9wYWNrZXQgPSAwOwogCiAgICAgVENfTU9E
VUxFX1NFTEZfQ0hFQ0soc2VsZiwgImVuY29kZV92aWRlbyIpOwogCkBAIC0xNDk3LDEyICsxNTQz
LDE1IEBACiAKICAgICBwZC0+cHJlX2VuY29kZV92aWRlbyhwZCwgaW5mcmFtZSk7IAogCisgICAg
YXZfaW5pdF9wYWNrZXQoJnBrdCk7CisgICAgcGt0LmRhdGEgPSBvdXRmcmFtZS0+dmlkZW9fYnVm
OworICAgIHBrdC5zaXplID0gaW5mcmFtZS0+dmlkZW9fc2l6ZTsKKwogICAgIFRDX0xPQ0tfTElC
QVZDT0RFQzsKLSAgICBvdXRmcmFtZS0+dmlkZW9fbGVuID0gYXZjb2RlY19lbmNvZGVfdmlkZW8o
JnBkLT5mZl92Y29udGV4dCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgb3V0ZnJhbWUtPnZpZGVvX2J1ZiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgaW5mcmFtZS0+dmlkZW9fc2l6ZSwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJnBkLT5mZl92ZW5jX2ZyYW1lKTsKKyAg
ICByZXQgPSBhdmNvZGVjX2VuY29kZV92aWRlbzIoJnBkLT5mZl92Y29udGV4dCwgICAmcGt0LAor
ICAgIAkJCQkmcGQtPmZmX3ZlbmNfZnJhbWUsICZnb3RfcGFja2V0KTsKICAgICBUQ19VTkxPQ0tf
TElCQVZDT0RFQzsKKyAgICBvdXRmcmFtZS0+dmlkZW9fbGVuID0gcmV0ID8gcmV0IDogcGt0LnNp
emU7CiAKICAgICBpZiAob3V0ZnJhbWUtPnZpZGVvX2xlbiA8IDApIHsKICAgICAgICAgdGNfbG9n
X3dhcm4oTU9EX05BTUUsICJlbmNvZGVyIGVycm9yOiBzaXplICglaSkiLAotLS0gYS9leHBvcnQv
YXVkX2F1eC5jCTIwMTEtMTEtMTkgMTc6NTA6MjcuMDAwMDAwMDAwICswMTAwCisrKyBiL2V4cG9y
dC9hdWRfYXV4LmMJMjAxNi0wMi0xNSAxNjowODozNy45MTQ0ODgxMTYgKzAxMDAKQEAgLTMyNiwx
MCArMzI2LDEwIEBACiAKICAgICBzd2l0Y2ggKG9fY29kZWMpIHsKICAgICAgIGNhc2UgICAweDUw
OgotICAgICAgICBjb2RlaWQgPSBDT0RFQ19JRF9NUDI7CisgICAgICAgIGNvZGVpZCA9IEFWX0NP
REVDX0lEX01QMjsKICAgICAgICAgYnJlYWs7CiAgICAgICBjYXNlIDB4MjAwMDoKLSAgICAgICAg
Y29kZWlkID0gQ09ERUNfSURfQUMzOworICAgICAgICBjb2RlaWQgPSBBVl9DT0RFQ19JRF9BQzM7
CiAgICAgICAgIGJyZWFrOwogICAgICAgZGVmYXVsdDoKICAgICAgICAgdGNfd2FybigiY2Fubm90
IGluaXQgZmZtcGVnIHdpdGggJXgiLCBvX2NvZGVjKTsKQEAgLTM0Niw3ICszNDYsNyBAQAogCiAg
ICAgLy8tLSBzZXQgcGFyYW1ldGVycyAoYml0cmF0ZSwgY2hhbm5lbHMgYW5kIHNhbXBsZS1yYXRl
KSAtLQogICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0KLSAgICBhdmNvZGVjX2dldF9jb250ZXh0X2RlZmF1bHRzKCZtcGFfY3R4KTsK
KyAgICBhdmNvZGVjX2dldF9jb250ZXh0X2RlZmF1bHRzMygmbXBhX2N0eCwgbXBhX2NvZGVjKTsK
ICNpZiBMSUJBVkNPREVDX1ZFUlNJT05fTUFKT1IgPCA1MwogICAgIG1wYV9jdHguY29kZWNfdHlw
ZSAgPSBDT0RFQ19UWVBFX0FVRElPOwogI2Vsc2UKQEAgLTM1OSwxMSArMzU5LDExIEBACiAgICAg
Ly8tLSBvcGVuIGNvZGVjIC0tCiAgICAgLy8tLS0tLS0tLS0tLS0tLS0tCiAgICAgVENfTE9DS19M
SUJBVkNPREVDOwotICAgIHJldCA9IGF2Y29kZWNfb3BlbigmbXBhX2N0eCwgbXBhX2NvZGVjKTsK
KyAgICByZXQgPSBhdmNvZGVjX29wZW4yKCZtcGFfY3R4LCBtcGFfY29kZWMsIE5VTEwpOwogICAg
IFRDX1VOTE9DS19MSUJBVkNPREVDOwogICAgIGlmIChyZXQgPCAwKSB7CiAgICAgICAgIHRjX3dh
cm4oInRjX2F1ZGlvX2luaXRfZmZtcGVnOiBjb3VsZCBub3Qgb3BlbiAlcyBjb2RlYyAhIiwKLSAg
ICAgICAgICAgICAgICAoY29kZWlkID09IENPREVDX0lEX01QMikgPyJtcGEiIDoiYWMzIik7Cisg
ICAgICAgICAgICAgICAgKGNvZGVpZCA9PSBBVl9DT0RFQ19JRF9NUDIpID8ibXBhIiA6ImFjMyIp
OwogICAgICAgICByZXR1cm4oVENfRVhQT1JUX0VSUk9SKTsKICAgICB9CiAKQEAgLTg0Niw2ICs4
NDYsOSBAQAogI2lmZGVmIEhBVkVfRkZNUEVHCiAgICAgaW50ICBpbl9zaXplLCBvdXRfc2l6ZTsK
ICAgICBjaGFyICppbl9idWY7CisgICAgaW50IGdvdF9wYWNrZXQ7CisgICAgQVZQYWNrZXQgYXZw
a3QgPSB7IDAgfTsKKyAgICBBVkZyYW1lICpmcmFtZSA9IGF2X2ZyYW1lX2FsbG9jKCk7CiAKICAg
ICAvLy0tIGlucHV0IGJ1ZmZlciBhbmQgYW1vdW50IG9mIGJ5dGVzIC0tCiAgICAgaW5fc2l6ZSA9
IGF1ZF9zaXplOwpAQCAtODY2LDEwICs4NjksMTQgQEAKIAogICAgIGFjX21lbWNweSgmbXBhX2J1
ZlttcGFfYnVmX3B0cl0sIGluX2J1ZiwgYnl0ZXNfbmVlZGVkKTsKIAorICAgIGZyYW1lLT5uYl9z
YW1wbGVzID0gbXBhX2N0eC5mcmFtZV9zaXplOworICAgIGF2Y29kZWNfZmlsbF9hdWRpb19mcmFt
ZShmcmFtZSwgbXBhX2N0eC5jaGFubmVscywgbXBhX2N0eC5zYW1wbGVfZm10LCAoY29uc3QgdWlu
dDhfdCAqKW1wYV9idWYsIG1wYV9ieXRlc19wZiwgMSk7CisgICAgYXZwa3QuZGF0YSA9IG91dHB1
dDsKKyAgICBhdnBrdC5zaXplID0gT1VUUFVUX1NJWkU7CiAgICAgVENfTE9DS19MSUJBVkNPREVD
OwotICAgIG91dF9zaXplID0gYXZjb2RlY19lbmNvZGVfYXVkaW8oJm1wYV9jdHgsICh1bnNpZ25l
ZCBjaGFyICopb3V0cHV0LAotICAgICAgICAgICAgICAgICAgICBPVVRQVVRfU0laRSwgKHNob3J0
ICopbXBhX2J1Zik7CisgICAgb3V0X3NpemUgPSBhdmNvZGVjX2VuY29kZV9hdWRpbzIoJm1wYV9j
dHgsICZhdnBrdCwgZnJhbWUsICZnb3RfcGFja2V0KTsKICAgICBUQ19VTkxPQ0tfTElCQVZDT0RF
QzsKKyAgICBvdXRfc2l6ZSA9IGF2cGt0LnNpemU7CiAgICAgdGNfYXVkaW9fd3JpdGUob3V0cHV0
LCBvdXRfc2l6ZSwgYXZpZmlsZSk7CiAKICAgICAgICAgaW5fc2l6ZSAtPSBieXRlc19uZWVkZWQ7
CkBAIC04ODQsNiArODkxLDcgQEAKIAogICAgIGFjX21lbWNweSgmbXBhX2J1ZlttcGFfYnVmX3B0
cl0sIGF1ZF9idWZmZXIsIGJ5dGVzX2F2YWlsKTsKICAgICAgICAgbXBhX2J1Zl9wdHIgKz0gYnl0
ZXNfYXZhaWw7CisgICAgICAgIGF2X2ZyYW1lX2ZyZWUoJmZyYW1lKTsKICAgICAgICAgcmV0dXJu
ICgwKTsKICAgICAgIH0KICAgICB9IC8vYnl0ZXMgYXZhaWxhYmUgZnJvbSBsYXN0IGNhbGw/CkBA
IC04OTMsMTAgKzkwMSwxNSBAQAogICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogCiAgICAgd2hpbGUgKGluX3NpemUgPj0gbXBhX2J5dGVz
X3BmKSB7CisgICAgICBhdl9mcmFtZV91bnJlZihmcmFtZSk7CisgICAgICBmcmFtZS0+bmJfc2Ft
cGxlcyA9IG1wYV9jdHguZnJhbWVfc2l6ZTsKKyAgICAgIGF2Y29kZWNfZmlsbF9hdWRpb19mcmFt
ZShmcmFtZSwgbXBhX2N0eC5jaGFubmVscywgbXBhX2N0eC5zYW1wbGVfZm10LCAoY29uc3QgdWlu
dDhfdCAqKWluX2J1ZiwgbXBhX2J5dGVzX3BmLCAxKTsKKyAgICAgIGF2cGt0LmRhdGEgPSBvdXRw
dXQ7CisgICAgICBhdnBrdC5zaXplID0gT1VUUFVUX1NJWkU7CiAgICAgICBUQ19MT0NLX0xJQkFW
Q09ERUM7Ci0gICAgICBvdXRfc2l6ZSA9IGF2Y29kZWNfZW5jb2RlX2F1ZGlvKCZtcGFfY3R4LCAo
dW5zaWduZWQgY2hhciAqKW91dHB1dCwKLSAgICAgICAgICAgICAgICAgICAgICBPVVRQVVRfU0la
RSwgKHNob3J0ICopaW5fYnVmKTsKKyAgICAgIG91dF9zaXplID0gYXZjb2RlY19lbmNvZGVfYXVk
aW8yKCZtcGFfY3R4LCAmYXZwa3QsIGZyYW1lLCAmZ290X3BhY2tldCk7CiAgICAgICBUQ19VTkxP
Q0tfTElCQVZDT0RFQzsKKyAgICAgIG91dF9zaXplID0gYXZwa3Quc2l6ZTsKIAogICAgICAgdGNf
YXVkaW9fd3JpdGUob3V0cHV0LCBvdXRfc2l6ZSwgYXZpZmlsZSk7CiAKQEAgLTkwNCw2ICs5MTcs
OCBAQAogICAgICAgaW5fYnVmICArPSBtcGFfYnl0ZXNfcGY7CiAgICAgfQogCisgICAgYXZfZnJh
bWVfZnJlZSgmZnJhbWUpOworCiAgICAgLy8tLSBob2xkIHJlc3Qgb2YgYnl0ZXMgaW4gbXBhLWJ1
ZmZlciAtLQogICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAg
ICBpZiAoaW5fc2l6ZSA+IDApIHsKLS0tIGEvZXhwb3J0L2V4cG9ydF9mZm1wZWcuYwkyMDExLTEx
LTE5IDE3OjUwOjI3LjAwMDAwMDAwMCArMDEwMAorKysgYi9leHBvcnQvZXhwb3J0X2ZmbXBlZy5j
CTIwMTYtMDItMTUgMTY6MDg6MzcuOTE1NDg4MTM5ICswMTAwCkBAIC0xMjIsNiArMTIyLDcgQEAK
IHN0YXRpYyBBVkZyYW1lICAgICAgICAgICAgICpsYXZjX2NvbnZlcnRfZnJhbWUgPSBOVUxMOwog
CiBzdGF0aWMgQVZDb2RlYyAgICAgICAgICAgICAqbGF2Y192ZW5jX2NvZGVjID0gTlVMTDsKK3N0
YXRpYyBBVkRpY3Rpb25hcnkgICAgICAgICpsYXZjX3ZlbmNfb3B0cyA9IE5VTEw7CiBzdGF0aWMg
QVZGcmFtZSAgICAgICAgICAgICAqbGF2Y192ZW5jX2ZyYW1lID0gTlVMTDsKIHN0YXRpYyBBVkNv
ZGVjQ29udGV4dCAgICAgICpsYXZjX3ZlbmNfY29udGV4dDsKIHN0YXRpYyBhdmlfdCAgICAgICAg
ICAgICAgICphdmlmaWxlID0gTlVMTDsKQEAgLTE4MCw3ICsxODEsNyBAQAogCiAKIC8qIFNUQVJU
OiBDT1BJRUQgRlJPTSBmZm1wZWctMC41X3AyMjg0NihmZm1wZWcuYywgY21kdXRpbHMuYykgKi8K
LSNpbmNsdWRlIDxsaWJhdmNvZGVjL29wdC5oPgorI2luY2x1ZGUgPGxpYmF2dXRpbC9vcHQuaD4K
ICNpbmNsdWRlIDxsaWJhdnV0aWwvYXZzdHJpbmcuaD4KICNpbmNsdWRlIDxsaWJzd3NjYWxlL3N3
c2NhbGUuaD4KIApAQCAtMjQ5LDkgKzI1MCw5IEBACiAgICAgZm9yKHR5cGU9MDsgdHlwZTxBVk1F
RElBX1RZUEVfTkIgJiYgcmV0Pj0gMDsgdHlwZSsrKXsKIAkJLyogR0xVRTogK2lmICovCiAJCWlm
ICh0eXBlID09IEFWTUVESUFfVFlQRV9WSURFTykgewotICAgICAgICBjb25zdCBBVk9wdGlvbiAq
bzIgPSBhdl9maW5kX29wdChhdmNvZGVjX29wdHNbMF0sIG9wdCwgTlVMTCwgb3B0X3R5cGVzW3R5
cGVdLCBvcHRfdHlwZXNbdHlwZV0pOwotICAgICAgICBpZihvMikKLSAgICAgICAgICAgIHJldCA9
IGF2X3NldF9zdHJpbmczKGF2Y29kZWNfb3B0c1t0eXBlXSwgb3B0LCBhcmcsIDEsICZvKTsKKyAg
ICAgICAgbyA9IGF2X29wdF9maW5kKGF2Y29kZWNfb3B0c1swXSwgb3B0LCBOVUxMLCBvcHRfdHlw
ZXNbdHlwZV0sIG9wdF90eXBlc1t0eXBlXSk7CisgICAgICAgIGlmKG8pCisgICAgICAgICAgICBy
ZXQgPSBhdl9vcHRfc2V0KGF2Y29kZWNfb3B0c1t0eXBlXSwgb3B0LCBhcmcsIDApOwogCQkvKiBH
TFVFOiAraWYgKi8KIAkJfQogICAgIH0KQEAgLTI2Niw3ICsyNjcsMTAgQEAKICAgICAgICAgaWYo
b3B0WzBdID09ICdhJykKICAgICAgICAgICAgIHJldCA9IGF2X3NldF9zdHJpbmczKGF2Y29kZWNf
b3B0c1tBVk1FRElBX1RZUEVfQVVESU9dLCBvcHQrMSwgYXJnLCAxLCAmbyk7CiAgICAgICAgIGVs
c2UgKi8gaWYob3B0WzBdID09ICd2JykKLSAgICAgICAgICAgIHJldCA9IGF2X3NldF9zdHJpbmcz
KGF2Y29kZWNfb3B0c1tBVk1FRElBX1RZUEVfVklERU9dLCBvcHQrMSwgYXJnLCAxLCAmbyk7CisJ
eworCSAgICBvID0gYXZfb3B0X2ZpbmQoYXZjb2RlY19vcHRzW0FWTUVESUFfVFlQRV9WSURFT10s
IG9wdCsxLCBOVUxMLCAwLCAwKTsKKyAgICAgICAgICAgIHJldCA9IGF2X29wdF9zZXQoYXZjb2Rl
Y19vcHRzW0FWTUVESUFfVFlQRV9WSURFT10sIG9wdCsxLCBhcmcsIDApOworCX0KIAkJLyogR0xV
RTogZGlzYWJsaW5nCiAgICAgICAgIGVsc2UgaWYob3B0WzBdID09ICdzJykKICAgICAgICAgICAg
IHJldCA9IGF2X3NldF9zdHJpbmczKGF2Y29kZWNfb3B0c1tBVk1FRElBX1RZUEVfU1VCVElUTEVd
LCBvcHQrMSwgYXJnLCAxLCAmbyk7CkBAIC00NzAsNyArNDc0LDYgQEAKICAgICB9CiAKICAgICBU
Q19MT0NLX0xJQkFWQ09ERUM7Ci0gICAgYXZjb2RlY19pbml0KCk7CiAgICAgYXZjb2RlY19yZWdp
c3Rlcl9hbGwoKTsKICAgICBUQ19VTkxPQ0tfTElCQVZDT0RFQzsKIApAQCAtNDg2LDExICs0ODks
MTEgQEAKIAkJICAgICAgICAgICAgY29kZWMtPm5hbWUsIGNvZGVjLT5mb3VyQ0MsIGNvZGVjLT5j
b21tZW50cyk7CiAgICAgfQogCi0gICAgbGF2Y192ZW5jX2NvbnRleHQgPSBhdmNvZGVjX2FsbG9j
X2NvbnRleHQoKTsKLSAgICBsYXZjX3ZlbmNfZnJhbWUgICA9IGF2Y29kZWNfYWxsb2NfZnJhbWUo
KTsKKyAgICBsYXZjX3ZlbmNfY29udGV4dCA9IGF2Y29kZWNfYWxsb2NfY29udGV4dDMobGF2Y192
ZW5jX2NvZGVjKTsKKyAgICBsYXZjX3ZlbmNfZnJhbWUgICA9IGF2X2ZyYW1lX2FsbG9jKCk7CiAK
LSAgICBsYXZjX2NvbnZlcnRfZnJhbWU9IGF2Y29kZWNfYWxsb2NfZnJhbWUoKTsKLSAgICBzaXpl
ID0gYXZwaWN0dXJlX2dldF9zaXplKFBJWF9GTVRfUkdCMjQsIHZvYi0+ZXhfdl93aWR0aCwgdm9i
LT5leF92X2hlaWdodCk7CisgICAgbGF2Y19jb252ZXJ0X2ZyYW1lPSBhdl9mcmFtZV9hbGxvYygp
OworICAgIHNpemUgPSBhdnBpY3R1cmVfZ2V0X3NpemUoQVZfUElYX0ZNVF9SR0IyNCwgdm9iLT5l
eF92X3dpZHRoLCB2b2ItPmV4X3ZfaGVpZ2h0KTsKICAgICBlbmNfYnVmZmVyID0gdGNfbWFsbG9j
KHNpemUpOwogCiAgICAgaWYgKGxhdmNfdmVuY19jb250ZXh0ID09IE5VTEwgfHwgIWVuY19idWZm
ZXIgfHwgIWxhdmNfY29udmVydF9mcmFtZSkgewpAQCAtNjM0LDcgKzYzNyw3IEBACiAgICAgICAg
IGxhdmNfcGFyYW1fcmNfbWF4X3JhdGUgPSAyNTE2OwogICAgICAgICBsYXZjX3BhcmFtX3JjX2J1
ZmZlcl9zaXplID0gMjI0ICogODsKICAgICAgICAgbGF2Y19wYXJhbV9yY19idWZmZXJfYWdncmVz
c2l2aXR5ID0gOTk7Ci0gICAgICAgIGxhdmNfcGFyYW1fc2Nhbl9vZmZzZXQgPSBDT0RFQ19GTEFH
X1NWQ0RfU0NBTl9PRkZTRVQ7CisgICAgICAgIGxhdmNfcGFyYW1fc2Nhbl9vZmZzZXQgPSAxOwog
CiAgICAgICAgIGJyZWFrOwogCkBAIC02NzQsNyArNjc3LDcgQEAKIAogICAgICAgICBsYXZjX3Bh
cmFtX3JjX2J1ZmZlcl9zaXplID0gMjI0ICogODsKICAgICAgICAgbGF2Y19wYXJhbV9yY19idWZm
ZXJfYWdncmVzc2l2aXR5ID0gOTk7Ci0gICAgICAgIGxhdmNfcGFyYW1fc2Nhbl9vZmZzZXQgPSBD
T0RFQ19GTEFHX1NWQ0RfU0NBTl9PRkZTRVQ7CisgICAgICAgIGxhdmNfcGFyYW1fc2Nhbl9vZmZz
ZXQgPSAxOwogCiAgICAgICAgIGJyZWFrOwogCkBAIC04MzgsOCArODQxLDEzIEBACiAgICAgbGF2
Y192ZW5jX2NvbnRleHQtPnJjX3N0cmF0ZWd5ICAgICAgICA9IGxhdmNfcGFyYW1fdnJjX3N0cmF0
ZWd5OwogICAgIGxhdmNfdmVuY19jb250ZXh0LT5iX2ZyYW1lX3N0cmF0ZWd5ICAgPSBsYXZjX3Bh
cmFtX3ZiX3N0cmF0ZWd5OwogICAgIGxhdmNfdmVuY19jb250ZXh0LT5iX3F1YW50X29mZnNldCAg
ICAgPSBsYXZjX3BhcmFtX3ZiX3FvZmZzZXQ7Ci0gICAgbGF2Y192ZW5jX2NvbnRleHQtPmx1bWFf
ZWxpbV90aHJlc2hvbGQ9IGxhdmNfcGFyYW1fbHVtYV9lbGltX3RocmVzaG9sZDsKLSAgICBsYXZj
X3ZlbmNfY29udGV4dC0+Y2hyb21hX2VsaW1fdGhyZXNob2xkPSBsYXZjX3BhcmFtX2Nocm9tYV9l
bGltX3RocmVzaG9sZDsKKworICAgIGNoYXIgYnVmWzEwMjRdOworI2RlZmluZSBzZXRfZGljdF9v
cHQodmFsLCBvcHQpIFwKKwlzbnByaW50ZihidWYsIHNpemVvZihidWYpLCAiJWkiLCB2YWwpOyBc
CisJYXZfZGljdF9zZXQoJmxhdmNfdmVuY19vcHRzLCBvcHQsIGJ1ZiwgMCkKKyAgICBzZXRfZGlj
dF9vcHQobGF2Y19wYXJhbV9sdW1hX2VsaW1fdGhyZXNob2xkLCAibHVtYV9lbGltX3RocmVzaG9s
ZCIpOworICAgIHNldF9kaWN0X29wdChsYXZjX3BhcmFtX2Nocm9tYV9lbGltX3RocmVzaG9sZCwg
ImNocm9tYV9lbGltX3RocmVzaG9sZCIpOwogICAgIGxhdmNfdmVuY19jb250ZXh0LT5ydHBfcGF5
bG9hZF9zaXplICAgPSBsYXZjX3BhcmFtX3BhY2tldF9zaXplOwogI2lmIExJQkFWQ09ERUNfVkVS
U0lPTl9JTlQgPCAoKDUyPDwxNikrKDA8PDgpKzApICAgCiAgICAgaWYgKGxhdmNfcGFyYW1fcGFj
a2V0X3NpemUpCkBAIC04NzAsNyArODc4LDcgQEAKICAgICBsYXZjX3ZlbmNfY29udGV4dC0+Y29u
dGV4dF9tb2RlbCAgICAgID0gbGF2Y19wYXJhbV9jb250ZXh0OwogICAgIGxhdmNfdmVuY19jb250
ZXh0LT5zY2VuZWNoYW5nZV90aHJlc2hvbGQ9IGxhdmNfcGFyYW1fc2NfdGhyZXNob2xkOwogICAg
IGxhdmNfdmVuY19jb250ZXh0LT5ub2lzZV9yZWR1Y3Rpb24gICAgPSBsYXZjX3BhcmFtX25vaXNl
X3JlZHVjdGlvbjsKLSAgICBsYXZjX3ZlbmNfY29udGV4dC0+aW50ZXJfdGhyZXNob2xkICAgID0g
bGF2Y19wYXJhbV9pbnRlcl90aHJlc2hvbGQ7CisgICAgc2V0X2RpY3Rfb3B0KGxhdmNfcGFyYW1f
aW50ZXJfdGhyZXNob2xkLCAiaW50ZXJfdGhyZXNob2xkIik7CiAgICAgbGF2Y192ZW5jX2NvbnRl
eHQtPmludHJhX2RjX3ByZWNpc2lvbiA9IGxhdmNfcGFyYW1faW50cmFfZGNfcHJlY2lzaW9uOwog
ICAgIGxhdmNfdmVuY19jb250ZXh0LT5za2lwX3RvcCAgICAgICAgICAgPSBsYXZjX3BhcmFtX3Nr
aXBfdG9wOwogICAgIGxhdmNfdmVuY19jb250ZXh0LT5za2lwX2JvdHRvbSAgICAgICAgPSBsYXZj
X3BhcmFtX3NraXBfYm90dG9tOwpAQCAtODg3LDcgKzg5NSw3IEBACiAJCSAgICBsYXZjX3ZlbmNf
Y29udGV4dC0+dGhyZWFkX2NvdW50KTsKICAgICB9CiAKLSAgICBhdmNvZGVjX3RocmVhZF9pbml0
KGxhdmNfdmVuY19jb250ZXh0LCBsYXZjX3BhcmFtX3RocmVhZHMpOworICAgIGxhdmNfdmVuY19j
b250ZXh0LT50aHJlYWRfY291bnQgPSBsYXZjX3BhcmFtX3RocmVhZHM7CiAKICAgICBpZiAobGF2
Y19wYXJhbV9pbnRyYV9tYXRyaXgpIHsKICAgICAgICAgY2hhciAqdG1wOwpAQCAtMTA2MSwxOSAr
MTA2OSwxOCBAQAogICAgIGxhdmNfdmVuY19jb250ZXh0LT5pbGRjdF9jbXAgID0gbGF2Y19wYXJh
bV9pbGRjdF9jbXA7CiAgICAgbGF2Y192ZW5jX2NvbnRleHQtPmRpYV9zaXplICAgPSBsYXZjX3Bh
cmFtX2RpYV9zaXplOwogICAgIGxhdmNfdmVuY19jb250ZXh0LT5mbGFncyB8PSBsYXZjX3BhcmFt
X3FwZWw7Ci0gICAgbGF2Y192ZW5jX2NvbnRleHQtPmZsYWdzIHw9IGxhdmNfcGFyYW1fZ21jOwor
ICAgIGlmKGxhdmNfcGFyYW1fZ21jKQorICAgICAgICBhdl9kaWN0X3NldCgmbGF2Y192ZW5jX29w
dHMsICJnbWMiLCAiMSIsIDApOwogICAgIGxhdmNfdmVuY19jb250ZXh0LT5mbGFncyB8PSBsYXZj
X3BhcmFtX2Nsb3NlZGdvcDsKICAgICBsYXZjX3ZlbmNfY29udGV4dC0+ZmxhZ3MgfD0gbGF2Y19w
YXJhbV90cnVuYzsKICAgICBsYXZjX3ZlbmNfY29udGV4dC0+ZmxhZ3MgfD0gbGF2Y19wYXJhbV9h
aWM7Ci0gICAgbGF2Y192ZW5jX2NvbnRleHQtPmZsYWdzIHw9IGxhdmNfcGFyYW1fdW12OwogICAg
IGxhdmNfdmVuY19jb250ZXh0LT5mbGFncyB8PSBsYXZjX3BhcmFtX3Y0bXY7Ci0gICAgbGF2Y192
ZW5jX2NvbnRleHQtPmZsYWdzIHw9IGxhdmNfcGFyYW1fZGF0YV9wYXJ0aXRpb25pbmc7Ci0gICAg
bGF2Y192ZW5jX2NvbnRleHQtPmZsYWdzIHw9IGxhdmNfcGFyYW1fY2JwOwotICAgIGxhdmNfdmVu
Y19jb250ZXh0LT5mbGFncyB8PSBsYXZjX3BhcmFtX212MDsKLSAgICBsYXZjX3ZlbmNfY29udGV4
dC0+ZmxhZ3MgfD0gbGF2Y19wYXJhbV9xcF9yZDsKLSAgICBsYXZjX3ZlbmNfY29udGV4dC0+Zmxh
Z3MgfD0gbGF2Y19wYXJhbV9zY2FuX29mZnNldDsKLSAgICBsYXZjX3ZlbmNfY29udGV4dC0+Zmxh
Z3MgfD0gbGF2Y19wYXJhbV9zczsKLSAgICBsYXZjX3ZlbmNfY29udGV4dC0+ZmxhZ3MgfD0gbGF2
Y19wYXJhbV9hbHQ7CisgICAgaWYobGF2Y19wYXJhbV9jYnApCisgICAgCWF2X2RpY3Rfc2V0KCZs
YXZjX3ZlbmNfb3B0cywgIm1wdl9mbGFncyIsICIrY2JwX3JkIiwgMCk7CisgICAgaWYobGF2Y19w
YXJhbV9tdjApCisgICAgICAgIGF2X2RpY3Rfc2V0KCZsYXZjX3ZlbmNfb3B0cywgIm1wdl9mbGFn
cyIsICIrbXYwIiwgMCk7CisgICAgaWYobGF2Y19wYXJhbV9xcF9yZCkKKyAgICAJYXZfZGljdF9z
ZXQoJmxhdmNfdmVuY19vcHRzLCAibXB2X2ZsYWdzIiwgIitxcF9yZCIsIDApOwogICAgIGxhdmNf
dmVuY19jb250ZXh0LT5mbGFncyB8PSBsYXZjX3BhcmFtX2lsbWU7CiAjaWYgTElCQVZDT0RFQ19W
RVJTSU9OX0lOVCA8ICgoNTI8PDE2KSsoMDw8OCkrMCkgICAKICAgICBsYXZjX3ZlbmNfY29udGV4
dC0+ZmxhZ3MgfD0gbGF2Y19wYXJhbV90cmVsbDsKQEAgLTEwODQsNyArMTA5MSw3IEBACiAgICAg
aWYgKGxhdmNfcGFyYW1fZ3JheSkKICAgICAgICAgbGF2Y192ZW5jX2NvbnRleHQtPmZsYWdzIHw9
IENPREVDX0ZMQUdfR1JBWTsKICAgICBpZiAobGF2Y19wYXJhbV9ub3JtYWxpemVfYXFwKQotICAg
ICAgICBsYXZjX3ZlbmNfY29udGV4dC0+ZmxhZ3MgfD0gQ09ERUNfRkxBR19OT1JNQUxJWkVfQVFQ
OworICAgICAgICBhdl9kaWN0X3NldCgmbGF2Y192ZW5jX29wdHMsICJtcHZfZmxhZ3MiLCAiK25h
cSIsIDApOwogCiAgICAgc3dpdGNoKHZvYi0+ZW5jb2RlX2ZpZWxkcykgewogICAgIGNhc2UgVENf
RU5DT0RFX0ZJRUxEU19UT1BfRklSU1Q6CkBAIC0xMTEyLDcgKzExMTksNyBAQAogICAgIGxhdmNf
dmVuY19jb250ZXh0LT5wcmVkaWN0aW9uX21ldGhvZCA9IGxhdmNfcGFyYW1fcHJlZGljdGlvbl9t
ZXRob2Q7CiAKICAgICBpZihpc19odWZmeXV2KQotICAgICAgICBsYXZjX3ZlbmNfY29udGV4dC0+
cGl4X2ZtdCA9IFBJWF9GTVRfWVVWNDIyUDsKKyAgICAgICAgbGF2Y192ZW5jX2NvbnRleHQtPnBp
eF9mbXQgPSBBVl9QSVhfRk1UX1lVVjQyMlA7CiAgICAgZWxzZQogICAgIHsKICAgICAgICAgc3dp
dGNoKHBpeF9mbXQpCkBAIC0xMTIxLDE4ICsxMTI4LDE4IEBACiAgICAgICAgICAgICBjYXNlIENP
REVDX1JHQjoKICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICBpZihpc19tanBlZykKLSAg
ICAgICAgICAgICAgICAgICAgbGF2Y192ZW5jX2NvbnRleHQtPnBpeF9mbXQgPSBQSVhfRk1UX1lV
Vko0MjBQOworICAgICAgICAgICAgICAgICAgICBsYXZjX3ZlbmNfY29udGV4dC0+cGl4X2ZtdCA9
IEFWX1BJWF9GTVRfWVVWSjQyMFA7CiAgICAgICAgICAgICAgICAgZWxzZQotICAgICAgICAgICAg
ICAgICAgICBsYXZjX3ZlbmNfY29udGV4dC0+cGl4X2ZtdCA9IFBJWF9GTVRfWVVWNDIwUDsKKyAg
ICAgICAgICAgICAgICAgICAgbGF2Y192ZW5jX2NvbnRleHQtPnBpeF9mbXQgPSBBVl9QSVhfRk1U
X1lVVjQyMFA7CiAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICB9CiAKICAgICAg
ICAgICAgIGNhc2UgQ09ERUNfWVVWNDIyOgogICAgICAgICAgICAgewogICAgICAgICAgICAgICAg
IGlmKGlzX21qcGVnKQotICAgICAgICAgICAgICAgICAgICBsYXZjX3ZlbmNfY29udGV4dC0+cGl4
X2ZtdCA9IFBJWF9GTVRfWVVWSjQyMlA7CisgICAgICAgICAgICAgICAgICAgIGxhdmNfdmVuY19j
b250ZXh0LT5waXhfZm10ID0gQVZfUElYX0ZNVF9ZVVZKNDIyUDsKICAgICAgICAgICAgICAgICBl
bHNlCi0gICAgICAgICAgICAgICAgICAgIGxhdmNfdmVuY19jb250ZXh0LT5waXhfZm10ID0gUElY
X0ZNVF9ZVVY0MjJQOworICAgICAgICAgICAgICAgICAgICBsYXZjX3ZlbmNfY29udGV4dC0+cGl4
X2ZtdCA9IEFWX1BJWF9GTVRfWVVWNDIyUDsKICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg
ICAgICAgIH0KIApAQCAtMTIwMyw5ICsxMjEwLDggQEAKIAogICAgIGxhdmNfdmVuY19jb250ZXh0
LT5tZV9tZXRob2QgPSBNRV9aRVJPICsgbGF2Y19wYXJhbV92bWU7CiAKLQogCS8qIEZJWE1FOiB0
cmFuc2NvZGUgaXRzZWxmIGNvbnRhaW5zICJicm9rZW4gZmZtcGVnIGRlZmF1bHQgc2V0dGluZ3Mi
LCB0aHVzIHdlIG5lZWQgdG8gb3ZlcnJpZGUgdGhlbSEgKi8KLQlpZiAobGF2Y19wYXJhbV92aWRl
b19wcmVzZXQpIHsKKwlpZiAobGF2Y19wYXJhbV92aWRlb19wcmVzZXQgJiYgc3RyY21wKGxhdmNf
cGFyYW1fdmlkZW9fcHJlc2V0LCAibm9uZSIpKSB7CiAJCWF2Y29kZWNfb3B0c1tBVk1FRElBX1RZ
UEVfVklERU9dID0gbGF2Y192ZW5jX2NvbnRleHQ7CiAJCXZpZGVvX2NvZGVjX25hbWUgPSBmZm1w
ZWdfY29kZWNfbmFtZShjb2RlYy0+bmFtZSk7CiAKQEAgLTEyNDEsMjAgKzEyNDcsMzkgQEAKIAkJ
fQogCX0KIAorICAgIGlmIChsYXZjX3BhcmFtX3NjYW5fb2Zmc2V0KSB7CisgICAgICBhdl9kaWN0
X3NldCgmbGF2Y192ZW5jX29wdHMsICJzY2FuX29mZnNldCIsICIxIiwgMCk7CisgICAgfQorCisg
ICAgaWYgKGxhdmNfcGFyYW1fc3MpIHsKKyAgICAgIGF2X2RpY3Rfc2V0KCZsYXZjX3ZlbmNfb3B0
cywgInN0cnVjdHVyZWRfc2xpY2VzIiwgIjEiLCAwKTsKKyAgICB9CisKKyAgICBpZiAobGF2Y19w
YXJhbV9hbHQpIHsKKyAgICAgIGF2X2RpY3Rfc2V0KCZsYXZjX3ZlbmNfb3B0cywgImFsdGVybmF0
ZV9zY2FuIiwgIjEiLCAwKTsKKyAgICB9CisKKyAgICBpZiAobGF2Y19wYXJhbV91bXYpIHsKKyAg
ICAgIGF2X2RpY3Rfc2V0KCZsYXZjX3ZlbmNfb3B0cywgInVtdiIsICIxIiwgMCk7CisgICAgfQor
CisgICAgaWYgKGxhdmNfcGFyYW1fZGF0YV9wYXJ0aXRpb25pbmcpIHsKKyAgICAgIGF2X2RpY3Rf
c2V0KCZsYXZjX3ZlbmNfb3B0cywgInZkcGFydCIsICIxIiwgMCk7CisgICAgfQogCiAgICAgLy8t
LSBvcGVuIGNvZGVjIC0tCiAgICAgLy8tLS0tLS0tLS0tLS0tLS0tCiAgICAgVENfTE9DS19MSUJB
VkNPREVDOwotICAgIHJldCA9IGF2Y29kZWNfb3BlbihsYXZjX3ZlbmNfY29udGV4dCwgbGF2Y192
ZW5jX2NvZGVjKTsKKyAgICByZXQgPSBhdmNvZGVjX29wZW4yKGxhdmNfdmVuY19jb250ZXh0LCBs
YXZjX3ZlbmNfY29kZWMsICZsYXZjX3ZlbmNfb3B0cyk7CiAgICAgVENfVU5MT0NLX0xJQkFWQ09E
RUM7CiAgICAgaWYgKHJldCA8IDApIHsKICAgICAgIHRjX2xvZ193YXJuKE1PRF9OQU1FLCAiY291
bGQgbm90IG9wZW4gRkZNUEVHIGNvZGVjIik7CiAgICAgICByZXR1cm4gVENfRVhQT1JUX0VSUk9S
OwogICAgIH0KIAotICAgIGlmIChsYXZjX3ZlbmNfY29udGV4dC0+Y29kZWMtPmVuY29kZSA9PSBO
VUxMKSB7CisgICAgaWYgKGF2X2NvZGVjX2lzX2VuY29kZXIobGF2Y192ZW5jX2NvbnRleHQtPmNv
ZGVjKSA9PSAwKSB7CiAgICAgICB0Y19sb2dfd2FybihNT0RfTkFNRSwgImNvdWxkIG5vdCBvcGVu
IEZGTVBFRyBjb2RlYyAiCi0gICAgICAgICAgICAgICIobGF2Y192ZW5jX2NvbnRleHQtPmNvZGVj
LT5lbmNvZGUgPT0gTlVMTCkiKTsKKyAgICAgICAgICAgICAgIihhdl9jb2RlY19pc19lbmNvZGVy
KGxhdmNfdmVuY19jb250ZXh0LT5jb2RlYykgPT0gMCkiKTsKICAgICAgIHJldHVybiBUQ19FWFBP
UlRfRVJST1I7CiAgICAgfQogCkBAIC0xNTc0LDYgKzE1OTksOCBAQAogCiAgIGludCBvdXRfc2l6
ZTsKICAgY29uc3QgY2hhciBwaWN0X3R5cGVfY2hhcls1XT0geyc/JywgJ0knLCAnUCcsICdCJywg
J1MnfTsKKyAgQVZQYWNrZXQgcGt0OworICBpbnQgcmV0LCBnb3RfcGFja2V0ID0gMDsKIAogICBp
ZiAocGFyYW0tPmZsYWcgPT0gVENfVklERU8pIHsKIApAQCAtMTU5OCw3ICsxNjI1LDcgQEAKIAkg
ICAgICAgIAlZVVZfSU5JVF9QTEFORVMoc3JjLCBwYXJhbS0+YnVmZmVyLCBJTUdfWVVWX0RFRkFV
TFQsCiAJCQkgICAgICAgICAgICAgICAgCWxhdmNfdmVuY19jb250ZXh0LT53aWR0aCwgbGF2Y192
ZW5jX2NvbnRleHQtPmhlaWdodCk7CiAgICAgICAgICAgICAgICAgYXZwaWN0dXJlX2ZpbGwoKEFW
UGljdHVyZSAqKWxhdmNfdmVuY19mcmFtZSwgaW1nX2J1ZmZlciwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBQSVhfRk1UX1lVVjQyMlAsIGxhdmNfdmVuY19jb250ZXh0LT53aWR0aCwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBVl9QSVhfRk1UX1lVVjQyMlAsIGxhdmNf
dmVuY19jb250ZXh0LT53aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXZj
X3ZlbmNfY29udGV4dC0+aGVpZ2h0KTsKICAgICAgICAgCQkvKiBGSVhNRTogY2FuJ3QgdXNlIHRj
dl9jb252ZXJ0IChzZWUgZGVjb2RlX2xhdmMuYykgKi8KICAgICAgICAgICAgICAgICBhY19pbWdj
b252ZXJ0KHNyYywgSU1HX1lVVl9ERUZBVUxULApAQCAtMTYyOCw3ICsxNjU1LDcgQEAKIAkJICAg
ICAgICAgICAgICAgIAkJbGF2Y192ZW5jX2NvbnRleHQtPndpZHRoLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBsYXZjX3ZlbmNfY29udGV4dC0+aGVpZ2h0KTsKICAgICAgICAgICAg
ICAgICBhdnBpY3R1cmVfZmlsbCgoQVZQaWN0dXJlICopbGF2Y192ZW5jX2ZyYW1lLCBpbWdfYnVm
ZmVyLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBJWF9GTVRfWVVWNDIwUCwgbGF2
Y192ZW5jX2NvbnRleHQtPndpZHRoLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFW
X1BJWF9GTVRfWVVWNDIwUCwgbGF2Y192ZW5jX2NvbnRleHQtPndpZHRoLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGxhdmNfdmVuY19jb250ZXh0LT5oZWlnaHQpOwogICAgICAgICAg
ICAgICAgIGFjX2ltZ2NvbnZlcnQoc3JjLCBJTUdfWVVWNDIyUCwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGxhdmNfdmVuY19mcmFtZS0+ZGF0YSwgSU1HX1lVVjQyMFAsCkBAIC0xNjM5
LDcgKzE2NjYsNyBAQAogCiAgICAgICAgIGNhc2UgQ09ERUNfUkdCOgogICAgICAgICAgICAgYXZw
aWN0dXJlX2ZpbGwoKEFWUGljdHVyZSAqKWxhdmNfdmVuY19mcmFtZSwgaW1nX2J1ZmZlciwKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgIFBJWF9GTVRfWVVWNDIwUCwgbGF2Y192ZW5jX2NvbnRl
eHQtPndpZHRoLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgQVZfUElYX0ZNVF9ZVVY0MjBQ
LCBsYXZjX3ZlbmNfY29udGV4dC0+d2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBs
YXZjX3ZlbmNfY29udGV4dC0+aGVpZ2h0KTsKICAgICAJICAgIGFjX2ltZ2NvbnZlcnQoJnBhcmFt
LT5idWZmZXIsIElNR19SR0JfREVGQVVMVCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGxhdmNfdmVuY19mcmFtZS0+ZGF0YSwgSU1HX1lVVjQyMFAsCkBAIC0xNjUyLDEzICsxNjc5LDE3
IEBACiAgICAgICAgICAgICAgIHJldHVybiBUQ19FWFBPUlRfRVJST1I7CiAgICAgfQogCisgICAg
YXZfaW5pdF9wYWNrZXQoJnBrdCk7CisgICAgcGt0LmRhdGEgPSBlbmNfYnVmZmVyOworICAgIHBr
dC5zaXplID0gc2l6ZTsKIAogICAgIFRDX0xPQ0tfTElCQVZDT0RFQzsKLSAgICBvdXRfc2l6ZSA9
IGF2Y29kZWNfZW5jb2RlX3ZpZGVvKGxhdmNfdmVuY19jb250ZXh0LAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZW5jX2J1ZmZlciwgc2l6ZSwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGxhdmNfdmVuY19mcmFtZSk7CisgICAgcmV0ID0gYXZjb2RlY19l
bmNvZGVfdmlkZW8yKGxhdmNfdmVuY19jb250ZXh0LCAmcGt0LAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgbGF2Y192ZW5jX2ZyYW1lLCAmZ290X3BhY2tldCk7CiAgICAgVENf
VU5MT0NLX0xJQkFWQ09ERUM7CiAKKyAgICBvdXRfc2l6ZSA9IHJldCA/IHJldCA6IHBrdC5zaXpl
OworCiAgICAgaWYgKG91dF9zaXplIDwgMCkgewogICAgICAgdGNfbG9nX3dhcm4oTU9EX05BTUUs
ICJlbmNvZGVyIGVycm9yOiBzaXplICglZCkiLCBvdXRfc2l6ZSk7CiAgICAgICByZXR1cm4gVENf
RVhQT1JUX0VSUk9SOwotLS0gYS9leHBvcnQvZmZtcGVnX2NmZy5jCTIwMTEtMTEtMTkgMTc6NTA6
MjcuMDAwMDAwMDAwICswMTAwCisrKyBiL2V4cG9ydC9mZm1wZWdfY2ZnLmMJMjAxNi0wMi0xNSAx
NjowODozNy45MTY0ODgxNjEgKzAxMDAKQEAgLTM0LDggKzM0LDYgQEAKIC8vaW50IGxhdmNfcGFy
YW1fdnFzY2FsZSA9IDA7CiAvL2ludCBsYXZjX3BhcmFtX3ZxbWluID0gMjsKIC8vaW50IGxhdmNf
cGFyYW1fdnFtYXggPSAzMTsKLWludCBsYXZjX3BhcmFtX21iX3FtaW4gPSAyOwotaW50IGxhdmNf
cGFyYW1fbWJfcW1heCA9IDMxOwogaW50IGxhdmNfcGFyYW1fbG1pbiA9IDI7CiBpbnQgbGF2Y19w
YXJhbV9sbWF4ID0gMzE7CiBpbnQgbGF2Y19wYXJhbV92cWRpZmYgPSAzOwpAQCAtMTI2LDcgKzEy
NCw3IEBACiAvL2ludCBsYXZjX3BhcmFtX2F0YWcgPSAwOwogLy9pbnQgbGF2Y19wYXJhbV9hYml0
cmF0ZSA9IDIyNDsKIAotY2hhciAqbGF2Y19wYXJhbV92aWRlb19wcmVzZXQgPSAibWVkaXVtIjsK
K2NoYXIgKmxhdmNfcGFyYW1fdmlkZW9fcHJlc2V0ID0gIm5vbmUiOwogY2hhciAqbGF2Y19wYXJh
bV9mZm1wZWdfZGF0YWRpciA9ICIvdXNyL3NoYXJlL2ZmbXBlZyI7CiAKIFRDQ29uZmlnRW50cnkg
bGF2Y29wdHNfY29uZltdPXsKQEAgLTE0MywxNSArMTQxLDEzIEBACiAvLyAgICB7InZxc2NhbGUi
LCAmbGF2Y19wYXJhbV92cXNjYWxlLCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9GTEFHX1JBTkdF
LCAxLCAzMX0sCiAvLyAgICB7InZxbWluIiwgJmxhdmNfcGFyYW1fdnFtaW4sIFRDQ09ORl9UWVBF
X0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIDEsIDMxfSwKIC8vICAgIHsidnFtYXgiLCAmbGF2Y19w
YXJhbV92cW1heCwgVENDT05GX1RZUEVfSU5ULCBUQ0NPTkZfRkxBR19SQU5HRSwgMSwgMzF9LAot
ICAgIHsibWJxbWluIiwgJmxhdmNfcGFyYW1fbWJfcW1pbiwgVENDT05GX1RZUEVfSU5ULCBUQ0NP
TkZfRkxBR19SQU5HRSwgMSwgMzF9LAotICAgIHsibWJxbWF4IiwgJmxhdmNfcGFyYW1fbWJfcW1h
eCwgVENDT05GX1RZUEVfSU5ULCBUQ0NPTkZfRkxBR19SQU5HRSwgMSwgMzF9LAogICAgIHsibG1p
biIsICZsYXZjX3BhcmFtX2xtaW4sIFRDQ09ORl9UWVBFX0ZMT0FULCBUQ0NPTkZfRkxBR19SQU5H
RSwgMC4wMSwgMjU1LjB9LAogICAgIHsibG1heCIsICZsYXZjX3BhcmFtX2xtYXgsIFRDQ09ORl9U
WVBFX0ZMT0FULCBUQ0NPTkZfRkxBR19SQU5HRSwgMC4wMSwgMjU1LjB9LAogICAgIHsidnFkaWZm
IiwgJmxhdmNfcGFyYW1fdnFkaWZmLCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9GTEFHX1JBTkdF
LCAxLCAzMX0sCiAgICAgeyJ2cWNvbXAiLCAmbGF2Y19wYXJhbV92cWNvbXByZXNzLCBUQ0NPTkZf
VFlQRV9GTE9BVCwgVENDT05GX0ZMQUdfUkFOR0UsIDAuMCwgMS4wfSwKICAgICB7InZxYmx1ciIs
ICZsYXZjX3BhcmFtX3ZxYmx1ciwgVENDT05GX1RZUEVfRkxPQVQsIFRDQ09ORl9GTEFHX1JBTkdF
LCAwLjAsIDEuMH0sCiAgICAgeyJ2Yl9xZmFjdG9yIiwgJmxhdmNfcGFyYW1fdmJfcWZhY3Rvciwg
VENDT05GX1RZUEVfRkxPQVQsIFRDQ09ORl9GTEFHX1JBTkdFLCAtMzEuMCwgMzEuMH0sCi0gICAg
eyJ2bWF4X2JfZnJhbWVzIiwgJmxhdmNfcGFyYW1fdm1heF9iX2ZyYW1lcywgVENDT05GX1RZUEVf
SU5ULCBUQ0NPTkZfRkxBR19SQU5HRSwgMCwgRkZfTUFYX0JfRlJBTUVTfSwKKyAgICB7InZtYXhf
Yl9mcmFtZXMiLCAmbGF2Y19wYXJhbV92bWF4X2JfZnJhbWVzLCBUQ0NPTkZfVFlQRV9JTlQsIFRD
Q09ORl9GTEFHX1JBTkdFLCAwLCBJTlRfTUFYfSwKIC8vICAgIHsidnBhc3MiLCAmbGF2Y19wYXJh
bV92cGFzcywgVENDT05GX1RZUEVfSU5ULCBUQ0NPTkZfRkxBR19SQU5HRSwgMCwgMn0sCiAgICAg
eyJ2cmNfc3RyYXRlZ3kiLCAmbGF2Y19wYXJhbV92cmNfc3RyYXRlZ3ksIFRDQ09ORl9UWVBFX0lO
VCwgVENDT05GX0ZMQUdfUkFOR0UsIDAsIDJ9LAogICAgIHsidmJfc3RyYXRlZ3kiLCAmbGF2Y19w
YXJhbV92Yl9zdHJhdGVneSwgVENDT05GX1RZUEVfSU5ULCBUQ0NPTkZfRkxBR19SQU5HRSwgMCwg
MTB9LApAQCAtMTYwLDkgKzE1Niw5IEBACiAgICAgeyJ2Y2VsaW0iLCAmbGF2Y19wYXJhbV9jaHJv
bWFfZWxpbV90aHJlc2hvbGQsIFRDQ09ORl9UWVBFX0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIC05
OSwgOTl9LAogICAgIHsidnBzaXplIiwgJmxhdmNfcGFyYW1fcGFja2V0X3NpemUsIFRDQ09ORl9U
WVBFX0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIDAsIDEwMDAwMDAwMH0sCiAgICAgeyJ2c3RyaWN0
IiwgJmxhdmNfcGFyYW1fc3RyaWN0LCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9GTEFHX1JBTkdF
LCAtOTksIDk5fSwKLSAgICB7InZkcGFydCIsICZsYXZjX3BhcmFtX2RhdGFfcGFydGl0aW9uaW5n
LCBUQ0NPTkZfVFlQRV9GTEFHLCAwLCAwLCBDT0RFQ19GTEFHX1BBUlR9LAorICAgIHsidmRwYXJ0
IiwgJmxhdmNfcGFyYW1fZGF0YV9wYXJ0aXRpb25pbmcsIFRDQ09ORl9UWVBFX0ZMQUcsIDAsIDAs
IDF9LAogLy8gICAgeyJrZXlpbnQiLCAmbGF2Y19wYXJhbV9rZXlpbnQsIFRDQ09ORl9UWVBFX0lO
VCwgMCwgMCwgMH0sCi0gICAgeyJncmF5IiwgJmxhdmNfcGFyYW1fZ3JheSwgVENDT05GX1RZUEVf
RkxBRywgMCwgMCwgQ09ERUNfRkxBR19QQVJUfSwKKyAgICB7ImdyYXkiLCAmbGF2Y19wYXJhbV9n
cmF5LCBUQ0NPTkZfVFlQRV9GTEFHLCAwLCAwLCBDT0RFQ19GTEFHX0dSQVl9LAogICAgIHsibXBl
Z19xdWFudCIsICZsYXZjX3BhcmFtX21wZWdfcXVhbnQsIFRDQ09ORl9UWVBFX0ZMQUcsIDAsIDAs
IDF9LAogICAgIHsidmlfcWZhY3RvciIsICZsYXZjX3BhcmFtX3ZpX3FmYWN0b3IsIFRDQ09ORl9U
WVBFX0ZMT0FULCBUQ0NPTkZfRkxBR19SQU5HRSwgLTMxLjAsIDMxLjB9LAogICAgIHsidmlfcW9m
ZnNldCIsICZsYXZjX3BhcmFtX3ZpX3FvZmZzZXQsIFRDQ09ORl9UWVBFX0ZMT0FULCBUQ0NPTkZf
RkxBR19SQU5HRSwgMC4wLCAzMS4wfSwKQEAgLTIxMSwyNiArMjA3LDI2IEBACiAjZWxzZQogICAg
IHsiYWljIiwgJmxhdmNfcGFyYW1fYWljLCBUQ0NPTkZfVFlQRV9GTEFHLCAwLCAwLCBDT0RFQ19G
TEFHX0FDX1BSRUR9LAogI2VuZGlmICAgIAotICAgIHsidW12IiwgJmxhdmNfcGFyYW1fdW12LCBU
Q0NPTkZfVFlQRV9GTEFHLCAwLCAwLCBDT0RFQ19GTEFHX0gyNjNQX1VNVn0sCisgICAgeyJ1bXYi
LCAmbGF2Y19wYXJhbV91bXYsIFRDQ09ORl9UWVBFX0ZMQUcsIDAsIDAsIDF9LAogICAgIHsiaWJp
YXMiLCAmbGF2Y19wYXJhbV9pYmlhcywgVENDT05GX1RZUEVfSU5ULCBUQ0NPTkZfRkxBR19SQU5H
RSwgLTUxMiwgNTEyfSwKICAgICB7InBiaWFzIiwgJmxhdmNfcGFyYW1fcGJpYXMsIFRDQ09ORl9U
WVBFX0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIC01MTIsIDUxMn0sCiAgICAgeyJjb2RlciIsICZs
YXZjX3BhcmFtX2NvZGVyLCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9GTEFHX1JBTkdFLCAwLCAx
MH0sCiAgICAgeyJjb250ZXh0IiwgJmxhdmNfcGFyYW1fY29udGV4dCwgVENDT05GX1RZUEVfSU5U
LCBUQ0NPTkZfRkxBR19SQU5HRSwgMCwgMTB9LAogICAgIHsiaW50cmFfbWF0cml4IiwgJmxhdmNf
cGFyYW1faW50cmFfbWF0cml4LCBUQ0NPTkZfVFlQRV9TVFJJTkcsIDAsIDAsIDB9LAogICAgIHsi
aW50ZXJfbWF0cml4IiwgJmxhdmNfcGFyYW1faW50ZXJfbWF0cml4LCBUQ0NPTkZfVFlQRV9TVFJJ
TkcsIDAsIDAsIDB9LAotICAgIHsiY2JwIiwgJmxhdmNfcGFyYW1fY2JwLCBUQ0NPTkZfVFlQRV9G
TEFHLCAwLCAwLCBDT0RFQ19GTEFHX0NCUF9SRH0sCi0gICAgeyJtdjAiLCAmbGF2Y19wYXJhbV9t
djAsIFRDQ09ORl9UWVBFX0ZMQUcsIDAsIDAsIENPREVDX0ZMQUdfTVYwfSwKKyAgICB7ImNicCIs
ICZsYXZjX3BhcmFtX2NicCwgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgMX0sCisgICAgeyJtdjAi
LCAmbGF2Y19wYXJhbV9tdjAsIFRDQ09ORl9UWVBFX0ZMQUcsIDAsIDAsIDF9LAogICAgIHsibnIi
LCAmbGF2Y19wYXJhbV9ub2lzZV9yZWR1Y3Rpb24sIFRDQ09ORl9UWVBFX0lOVCwgVENDT05GX0ZM
QUdfUkFOR0UsIDAsIDEwMDAwMDB9LAotICAgIHsicXByZCIsICZsYXZjX3BhcmFtX3FwX3JkLCBU
Q0NPTkZfVFlQRV9GTEFHLCAwLCAwLCBDT0RFQ19GTEFHX1FQX1JEfSwKKyAgICB7InFwcmQiLCAm
bGF2Y19wYXJhbV9xcF9yZCwgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgMX0sCiAgICAgeyJ0aHJl
YWRzIiwgJmxhdmNfcGFyYW1fdGhyZWFkcywgVENDT05GX1RZUEVfSU5ULCBUQ0NPTkZfRkxBR19S
QU5HRSwgMSwgMTZ9LAotICAgIHsic3MiLCAmbGF2Y19wYXJhbV9zcywgVENDT05GX1RZUEVfRkxB
RywgMCwgMCwgQ09ERUNfRkxBR19IMjYzUF9TTElDRV9TVFJVQ1R9LAotICAgIHsic3ZjZF9zb2Yi
LCAmbGF2Y19wYXJhbV9zY2FuX29mZnNldCwgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNf
RkxBR19TVkNEX1NDQU5fT0ZGU0VUfSwKLSAgICB7ImFsdCIsICZsYXZjX3BhcmFtX2FsdCwgVEND
T05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNfRkxBR19BTFRfU0NBTn0sCisgICAgeyJzcyIsICZs
YXZjX3BhcmFtX3NzLCBUQ0NPTkZfVFlQRV9GTEFHLCAwLCAwLCAxfSwKKyAgICB7InN2Y2Rfc29m
IiwgJmxhdmNfcGFyYW1fc2Nhbl9vZmZzZXQsIFRDQ09ORl9UWVBFX0ZMQUcsIDAsIDAsIDF9LAor
ICAgIHsiYWx0IiwgJmxhdmNfcGFyYW1fYWx0LCBUQ0NPTkZfVFlQRV9GTEFHLCAwLCAwLCAxfSwK
ICAgICB7ImlsbWUiLCAmbGF2Y19wYXJhbV9pbG1lLCBUQ0NPTkZfVFlQRV9GTEFHLCAwLCAwLCBD
T0RFQ19GTEFHX0lOVEVSTEFDRURfTUV9LAogICAgIHsiaW50ZXJfdGhyZXNob2xkIiwgJmxhdmNf
cGFyYW1faW50ZXJfdGhyZXNob2xkLCBUQ0NPTkZfVFlQRV9JTlQsIFRDQ09ORl9GTEFHX1JBTkdF
LCAtMTAwMDAwMCwgMTAwMDAwMH0sCiAgICAgeyJzY190aHJlc2hvbGQiLCAmbGF2Y19wYXJhbV9z
Y190aHJlc2hvbGQsIFRDQ09ORl9UWVBFX0lOVCwgVENDT05GX0ZMQUdfUkFOR0UsIC0xMDAwMDAw
LCAxMDAwMDAwfSwKICAgICB7InRvcCIsICZsYXZjX3BhcmFtX3RvcCwgVENDT05GX1RZUEVfSU5U
LCBUQ0NPTkZfRkxBR19SQU5HRSwgLTEsIDF9LAotICAgIHsiZ21jIiwgJmxhdmNfcGFyYW1fZ21j
LCBUQ0NPTkZfVFlQRV9GTEFHLCAwLCAwLCBDT0RFQ19GTEFHX0dNQ30sCisgICAgeyJnbWMiLCAm
bGF2Y19wYXJhbV9nbWMsIFRDQ09ORl9UWVBFX0ZMQUcsIDAsIDAsIDF9LAogICAgIHsidHJ1bmMi
LCAmbGF2Y19wYXJhbV90cnVuYywgVENDT05GX1RZUEVfRkxBRywgMCwgMCwgQ09ERUNfRkxBR19U
UlVOQ0FURUR9LAogICAgIHsiY2xvc2VkZ29wIiwgJmxhdmNfcGFyYW1fY2xvc2VkZ29wLCBUQ0NP
TkZfVFlQRV9GTEFHLCAwLCAwLCBDT0RFQ19GTEFHX0NMT1NFRF9HT1B9LAogICAgIHsiaW50cmFf
ZGNfcHJlY2lzaW9uIiwgJmxhdmNfcGFyYW1faW50cmFfZGNfcHJlY2lzaW9uLCBUQ0NPTkZfVFlQ
RV9JTlQsIFRDQ09ORl9GTEFHX1JBTkdFLCAwLCAxNn0sCi0tLSBhL2V4cG9ydC9mZm1wZWdfY2Zn
LmgJMjAxMS0xMS0xOSAxNzo1MDoyNy4wMDAwMDAwMDAgKzAxMDAKKysrIGIvZXhwb3J0L2ZmbXBl
Z19jZmcuaAkyMDE2LTAyLTE1IDE2OjA4OjM3LjkxNjQ4ODE2MSArMDEwMApAQCAtMTMsOCArMTMs
NiBAQAogLy9leHRlcm4gaW50IGxhdmNfcGFyYW1fdnFzY2FsZTsKIC8vZXh0ZXJuIGludCBsYXZj
X3BhcmFtX3ZxbWluOwogLy9leHRlcm4gaW50IGxhdmNfcGFyYW1fdnFtYXg7Ci1leHRlcm4gaW50
IGxhdmNfcGFyYW1fbWJfcW1pbjsKLWV4dGVybiBpbnQgbGF2Y19wYXJhbV9tYl9xbWF4OwogZXh0
ZXJuIGludCBsYXZjX3BhcmFtX2xtaW47CiBleHRlcm4gaW50IGxhdmNfcGFyYW1fbG1heDsKIGV4
dGVybiBpbnQgbGF2Y19wYXJhbV92cWRpZmY7Ci0tLSBhL2ZpbHRlci9maWx0ZXJfcHAuYwkyMDEx
LTExLTE5IDE3OjUwOjI3LjAwMDAwMDAwMCArMDEwMAorKysgYi9maWx0ZXIvZmlsdGVyX3BwLmMJ
MjAxNi0wMi0xNSAxNjowODozNy45MTY0ODgxNjEgKzAxMDAKQEAgLTM4LDggKzM4LDggQEAKIAog
LyogRklYTUU6IHRoZXNlIHVzZSB0aGUgZmlsdGVyIElEIGFzIGFuIGluZGV4LS10aGUgSUQgY2Fu
IGdyb3cKICAqIGFyYml0cmFyaWx5IGxhcmdlLCBzbyB0aGlzIG5lZWRzIHRvIGJlIGZpeGVkICov
Ci1zdGF0aWMgcHBfbW9kZV90ICptb2RlWzEwMF07Ci1zdGF0aWMgcHBfY29udGV4dF90ICpjb250
ZXh0WzEwMF07CitzdGF0aWMgcHBfbW9kZSAqbW9kZVsxMDBdOworc3RhdGljIHBwX2NvbnRleHQg
KmNvbnRleHRbMTAwXTsKIHN0YXRpYyBpbnQgd2lkdGhbMTAwXSwgaGVpZ2h0WzEwMF07CiBzdGF0
aWMgaW50IHByZVsxMDBdOwogCi0tLSBhL2ltcG9ydC9kZWNvZGVfbGF2Yy5jCTIwMTEtMTEtMTkg
MTc6NTA6MjcuMDAwMDAwMDAwICswMTAwCisrKyBiL2ltcG9ydC9kZWNvZGVfbGF2Yy5jCTIwMTYt
MDItMTUgMTY6MDk6MDAuMjUyOTg4ODk3ICswMTAwCkBAIC01OCwzNyArNTgsMzcgQEAKIAogLy8g
Zm91ckNDIHRvIElEIG1hcHBpbmcgdGFrZW4gZnJvbSBNUGxheWVyJ3MgY29kZWNzLmNvbmYKIHN0
YXRpYyBzdHJ1Y3QgZmZtcGVnX2NvZGVjIGZmbXBlZ19jb2RlY3NbXSA9IHsKLSAge0NPREVDX0lE
X01TTVBFRzRWMSwgVENfQ09ERUNfRVJST1IsICJtcDQxIiwKKyAge0FWX0NPREVDX0lEX01TTVBF
RzRWMSwgVENfQ09ERUNfRVJST1IsICJtcDQxIiwKICAgICB7Ik1QNDEiLCAiRElWMSIsICIifX0s
Ci0gIHtDT0RFQ19JRF9NU01QRUc0VjIsIFRDX0NPREVDX01QNDIsICJtcDQyIiwKKyAge0FWX0NP
REVDX0lEX01TTVBFRzRWMiwgVENfQ09ERUNfTVA0MiwgIm1wNDIiLAogICAgIHsiTVA0MiIsICJE
SVYyIiwgIiJ9fSwKLSAge0NPREVDX0lEX01TTVBFRzRWMywgVENfQ09ERUNfRElWWDMsICJtc21w
ZWc0IiwKKyAge0FWX0NPREVDX0lEX01TTVBFRzRWMywgVENfQ09ERUNfRElWWDMsICJtc21wZWc0
IiwKICAgICB7IkRJVjMiLCAiRElWNSIsICJBUDQxIiwgIk1QRzMiLCAiTVA0MyIsICIifX0sCi0g
IHtDT0RFQ19JRF9NUEVHNCwgVENfQ09ERUNfRElWWDQsICJtcGVnNCIsCisgIHtBVl9DT0RFQ19J
RF9NUEVHNCwgVENfQ09ERUNfRElWWDQsICJtcGVnNCIsCiAgICAgeyJESVZYIiwgIlhWSUQiLCAi
TVA0UyIsICJNNFMyIiwgIk1QNFYiLCAiVU1QNCIsICJEWDUwIiwgIiJ9fSwKLSAge0NPREVDX0lE
X01KUEVHLCBUQ19DT0RFQ19NSlBFRywgIm1qcGVnIiwKKyAge0FWX0NPREVDX0lEX01KUEVHLCBU
Q19DT0RFQ19NSlBFRywgIm1qcGVnIiwKICAgICB7Ik1KUEciLCAiQVZSTiIsICJBVkRKIiwgIkpQ
RUciLCAiTUpQQSIsICJKRklGIiwgIiJ9fSwKLSAge0NPREVDX0lEX01QRUcxVklERU8sIFRDX0NP
REVDX01QRUcxVklERU8sICJtcGVnMXZpZGVvIiwKKyAge0FWX0NPREVDX0lEX01QRUcxVklERU8s
IFRDX0NPREVDX01QRUcxVklERU8sICJtcGVnMXZpZGVvIiwKICAgICB7Ik1QRzEiLCAiIn19LAot
ICB7Q09ERUNfSURfRFZWSURFTywgVENfQ09ERUNfRFYsICJkdnZpZGVvIiwKKyAge0FWX0NPREVD
X0lEX0RWVklERU8sIFRDX0NPREVDX0RWLCAiZHZ2aWRlbyIsCiAgICAgeyJEVlNEIiwgIiJ9fSwK
LSAge0NPREVDX0lEX1dNVjEsIFRDX0NPREVDX1dNVjEsICJ3bXYxIiwKKyAge0FWX0NPREVDX0lE
X1dNVjEsIFRDX0NPREVDX1dNVjEsICJ3bXYxIiwKICAgICB7IldNVjEiLCAiIn19LAotICB7Q09E
RUNfSURfV01WMiwgVENfQ09ERUNfV01WMiwgIndtdjIiLAorICB7QVZfQ09ERUNfSURfV01WMiwg
VENfQ09ERUNfV01WMiwgIndtdjIiLAogICAgIHsiV01WMiIsICIifX0sCi0gIHtDT0RFQ19JRF9I
VUZGWVVWLCBUQ19DT0RFQ19IVUZGWVVWLCAiaGZ5dSIsCisgIHtBVl9DT0RFQ19JRF9IVUZGWVVW
LCBUQ19DT0RFQ19IVUZGWVVWLCAiaGZ5dSIsCiAgICAgeyJIRllVIiwgIiJ9fSwKLSAge0NPREVD
X0lEX0gyNjNJLCBUQ19DT0RFQ19IMjYzSSwgImgyNjNpIiwKKyAge0FWX0NPREVDX0lEX0gyNjNJ
LCBUQ19DT0RFQ19IMjYzSSwgImgyNjNpIiwKICAgICB7IkkyNjMiLCAiIn19LAotICB7Q09ERUNf
SURfSDI2M1AsIFRDX0NPREVDX0gyNjNQLCAiaDI2M3AiLAorICB7QVZfQ09ERUNfSURfSDI2M1As
IFRDX0NPREVDX0gyNjNQLCAiaDI2M3AiLAogICAgIHsiSDI2MyIsICJVMjYzIiwgIlZJVjEiLCAi
In19LAotICB7Q09ERUNfSURfUlYxMCwgVENfQ09ERUNfUlYxMCwgInJ2MTAiLAorICB7QVZfQ09E
RUNfSURfUlYxMCwgVENfQ09ERUNfUlYxMCwgInJ2MTAiLAogICAgIHsiUlYxMCIsICJSVjEzIiwg
IiJ9fSwKLSAge0NPREVDX0lEX1NWUTEsIFRDX0NPREVDX1NWUTEsICJzdnExIiwKKyAge0FWX0NP
REVDX0lEX1NWUTEsIFRDX0NPREVDX1NWUTEsICJzdnExIiwKICAgICB7IlNWUTEiLCAiIn19LAot
ICB7Q09ERUNfSURfU1ZRMywgVENfQ09ERUNfU1ZRMywgInN2cTMiLAorICB7QVZfQ09ERUNfSURf
U1ZRMywgVENfQ09ERUNfU1ZRMywgInN2cTMiLAogICAgIHsiU1ZRMyIsICIifX0sCi0gIHtDT0RF
Q19JRF9NUEVHMlZJREVPLCBUQ19DT0RFQ19NUEVHMiwgIm1wZWcydmlkZW8iLAorICB7QVZfQ09E
RUNfSURfTVBFRzJWSURFTywgVENfQ09ERUNfTVBFRzIsICJtcGVnMnZpZGVvIiwKICAgICB7Ik1Q
RzIiLCAiIn19LAogICB7MCwgVENfQ09ERUNfVU5LTk9XTiwgTlVMTCwgeyIifX19OwogCkBAIC0x
NzAsNyArMTcwLDcgQEAKIAogICAvLyBTZXQgdGhlc2UgdG8gdGhlIGV4cGVjdGVkIHZhbHVlcyBz
byB0aGF0IGZmbXBlZydzIGRlY29kZXIgY2FuCiAgIC8vIHByb3Blcmx5IGRldGVjdCBpbnRlcmxh
Y2VkIGlucHV0LgotICBsYXZjX2RlY19jb250ZXh0ID0gYXZjb2RlY19hbGxvY19jb250ZXh0KCk7
CisgIGxhdmNfZGVjX2NvbnRleHQgPSBhdmNvZGVjX2FsbG9jX2NvbnRleHQzKE5VTEwpOwogICBp
ZiAobGF2Y19kZWNfY29udGV4dCA9PSBOVUxMKSB7CiAgICAgICB0Y19sb2dfZXJyb3IoX19GSUxF
X18sICJDb3VsZCBub3QgYWxsb2NhdGUgZW5vdWdoIG1lbW9yeS4iKTsKICAgICAgIGdvdG8gZGVj
b2Rlcl9lcnJvcjsKQEAgLTE4MSwxMiArMTgxLDEyIEBACiAjaWYgTElCQVZDT0RFQ19WRVJTSU9O
X0lOVCA8ICgoNTI8PDE2KSsoMDw8OCkrMCkKICAgbGF2Y19kZWNfY29udGV4dC0+ZXJyb3JfcmVz
aWxpZW5jZSAgPSAyOwogI2Vsc2UKLSAgbGF2Y19kZWNfY29udGV4dC0+ZXJyb3JfcmVjb2duaXRp
b24gPSAyOworICBsYXZjX2RlY19jb250ZXh0LT5lcnJfcmVjb2duaXRpb24gPSAyOwogI2VuZGlm
CiAgIGxhdmNfZGVjX2NvbnRleHQtPmVycm9yX2NvbmNlYWxtZW50ID0gMzsKICAgbGF2Y19kZWNf
Y29udGV4dC0+d29ya2Fyb3VuZF9idWdzID0gRkZfQlVHX0FVVE9ERVRFQ1Q7CiAKLSAgaWYgKGF2
Y29kZWNfb3BlbihsYXZjX2RlY19jb250ZXh0LCBsYXZjX2RlY19jb2RlYykgPCAwKSB7CisgIGlm
IChhdmNvZGVjX29wZW4yKGxhdmNfZGVjX2NvbnRleHQsIGxhdmNfZGVjX2NvZGVjLCBOVUxMKSA8
IDApIHsKICAgICAgIHRjX2xvZ19lcnJvcihfX0ZJTEVfXywgIkNvdWxkIG5vdCBpbml0aWFsaXpl
IHRoZSAnJXMnIGNvZGVjLiIsCiAJCSAgIGNvZGVjLT5uYW1lKTsKICAgICAgIGdvdG8gZGVjb2Rl
cl9lcnJvcjsKQEAgLTI5MCw4ICsyOTAsOCBAQAogCiAgICAgICAvLyBDb252ZXJ0IGF2Y29kZWMg
aW1hZ2UgdG8gdGhlIHJlcXVlc3RlZCBZVVYgb3IgUkdCIGZvcm1hdAogICAgICAgc3dpdGNoIChs
YXZjX2RlY19jb250ZXh0LT5waXhfZm10KSB7Ci0JY2FzZSBQSVhfRk1UX1lVVko0MjBQOgotCWNh
c2UgUElYX0ZNVF9ZVVY0MjBQOgorCWNhc2UgQVZfUElYX0ZNVF9ZVVZKNDIwUDoKKwljYXNlIEFW
X1BJWF9GTVRfWVVWNDIwUDoKIAkgICAgLy8gUmVtb3ZlICJkZWFkIHNwYWNlIiBhdCByaWdodCBl
ZGdlIG9mIHBsYW5lcywgaWYgYW55CiAJICAgIGlmIChwaWN0dXJlLmxpbmVzaXplWzBdICE9IGxh
dmNfZGVjX2NvbnRleHQtPndpZHRoKSB7CiAJCWludCB5OwpAQCAtMzE1LDcgKzMxNSw3IEBACiAJ
CQkgIHBpeF9mbXQ9PVRDX0NPREVDX1lVVjQyMFAgPyBJTUdfWVVWNDIwUCA6IElNR19SR0JfREVG
QVVMVCwKIAkJCSAgbGF2Y19kZWNfY29udGV4dC0+d2lkdGgsIGxhdmNfZGVjX2NvbnRleHQtPmhl
aWdodCk7CiAJICAgIGJyZWFrOwotCWNhc2UgUElYX0ZNVF9ZVVY0MTFQOgorCWNhc2UgQVZfUElY
X0ZNVF9ZVVY0MTFQOgogCSAgICBpZiAocGljdHVyZS5saW5lc2l6ZVswXSAhPSBsYXZjX2RlY19j
b250ZXh0LT53aWR0aCkgewogCQlpbnQgeTsKIAkJZm9yICh5ID0gMDsgeSA8IGxhdmNfZGVjX2Nv
bnRleHQtPmhlaWdodDsgeSsrKSB7CkBAIC0zMzQsOCArMzM0LDggQEAKIAkJCSAgcGl4X2ZtdD09
VENfQ09ERUNfWVVWNDIwUCA/IElNR19ZVVY0MjBQIDogSU1HX1JHQl9ERUZBVUxULAogCQkJICBs
YXZjX2RlY19jb250ZXh0LT53aWR0aCwgbGF2Y19kZWNfY29udGV4dC0+aGVpZ2h0KTsKIAkgICAg
YnJlYWs7Ci0JY2FzZSBQSVhfRk1UX1lVVko0MjJQOgotCWNhc2UgUElYX0ZNVF9ZVVY0MjJQOgor
CWNhc2UgQVZfUElYX0ZNVF9ZVVZKNDIyUDoKKwljYXNlIEFWX1BJWF9GTVRfWVVWNDIyUDoKIAkg
ICAgaWYgKHBpY3R1cmUubGluZXNpemVbMF0gIT0gbGF2Y19kZWNfY29udGV4dC0+d2lkdGgpIHsK
IAkJaW50IHk7CiAJCWZvciAoeSA9IDA7IHkgPCBsYXZjX2RlY19jb250ZXh0LT5oZWlnaHQ7IHkr
KykgewpAQCAtMzU0LDggKzM1NCw4IEBACiAJCQkgIHBpeF9mbXQ9PVRDX0NPREVDX1lVVjQyMFAg
PyBJTUdfWVVWNDIwUCA6IElNR19SR0JfREVGQVVMVCwKIAkJCSAgbGF2Y19kZWNfY29udGV4dC0+
d2lkdGgsIGxhdmNfZGVjX2NvbnRleHQtPmhlaWdodCk7CiAJICAgIGJyZWFrOwotCWNhc2UgUElY
X0ZNVF9ZVVZKNDQ0UDoKLQljYXNlIFBJWF9GTVRfWVVWNDQ0UDoKKwljYXNlIEFWX1BJWF9GTVRf
WVVWSjQ0NFA6CisJY2FzZSBBVl9QSVhfRk1UX1lVVjQ0NFA6CiAJICAgIGlmIChwaWN0dXJlLmxp
bmVzaXplWzBdICE9IGxhdmNfZGVjX2NvbnRleHQtPndpZHRoKSB7CiAJCWludCB5OwogCQlmb3Ig
KHkgPSAwOyB5IDwgbGF2Y19kZWNfY29udGV4dC0+aGVpZ2h0OyB5KyspIHsKLS0tIGEvaW1wb3J0
L2ltcG9ydF9mZm1wZWcuYwkyMDExLTExLTE5IDE3OjUwOjI3LjAwMDAwMDAwMCArMDEwMAorKysg
Yi9pbXBvcnQvaW1wb3J0X2ZmbXBlZy5jCTIwMTYtMDItMTUgMTY6MDg6NDguMjY5NzIwNjI3ICsw
MTAwCkBAIC01OSw1MSArNTksNTEgQEAKIAogLy8gZm91ckNDIHRvIElEIG1hcHBpbmcgdGFrZW4g
ZnJvbSBNUGxheWVyJ3MgY29kZWNzLmNvbmYKIHN0YXRpYyBzdHJ1Y3QgZmZtcGVnX2NvZGVjIGZm
bXBlZ19jb2RlY3NbXSA9IHsKLSAge0NPREVDX0lEX01TTVBFRzRWMSwgVENfQ09ERUNfRVJST1Is
ICJtcDQxIiwKKyAge0FWX0NPREVDX0lEX01TTVBFRzRWMSwgVENfQ09ERUNfRVJST1IsICJtcDQx
IiwKICAgICB7Ik1QNDEiLCAiRElWMSIsICIifX0sCi0gIHtDT0RFQ19JRF9NU01QRUc0VjIsIFRD
X0NPREVDX01QNDIsICJtcDQyIiwKKyAge0FWX0NPREVDX0lEX01TTVBFRzRWMiwgVENfQ09ERUNf
TVA0MiwgIm1wNDIiLAogICAgIHsiTVA0MiIsICJESVYyIiwgIiJ9fSwKLSAge0NPREVDX0lEX01T
TVBFRzRWMywgVENfQ09ERUNfRElWWDMsICJtc21wZWc0IiwKKyAge0FWX0NPREVDX0lEX01TTVBF
RzRWMywgVENfQ09ERUNfRElWWDMsICJtc21wZWc0IiwKICAgICB7IkRJVjMiLCAiRElWNSIsICJB
UDQxIiwgIk1QRzMiLCAiTVA0MyIsICIifX0sCi0gIHtDT0RFQ19JRF9NUEVHNCwgVENfQ09ERUNf
RElWWDQsICJtcGVnNCIsCisgIHtBVl9DT0RFQ19JRF9NUEVHNCwgVENfQ09ERUNfRElWWDQsICJt
cGVnNCIsCiAgICAgeyJESVZYIiwgIlhWSUQiLCAiTVA0UyIsICJNNFMyIiwgIk1QNFYiLCAiVU1Q
NCIsICJEWDUwIiwgIiJ9fSwKLSAge0NPREVDX0lEX01KUEVHLCBUQ19DT0RFQ19NSlBFRywgIm1q
cGVnIiwKKyAge0FWX0NPREVDX0lEX01KUEVHLCBUQ19DT0RFQ19NSlBFRywgIm1qcGVnIiwKICAg
ICB7Ik1KUEciLCAiQVZSTiIsICJBVkRKIiwgIkpQRUciLCAiTUpQQSIsICJKRklGIiwgIiJ9fSwK
LSAge0NPREVDX0lEX01QRUcxVklERU8sIFRDX0NPREVDX01QRzEsICJtcGVnMXZpZGVvIiwKKyAg
e0FWX0NPREVDX0lEX01QRUcxVklERU8sIFRDX0NPREVDX01QRzEsICJtcGVnMXZpZGVvIiwKICAg
ICB7Ik1QRzEiLCAiIn19LAotICB7Q09ERUNfSURfRFZWSURFTywgVENfQ09ERUNfRFYsICJkdnZp
ZGVvIiwKKyAge0FWX0NPREVDX0lEX0RWVklERU8sIFRDX0NPREVDX0RWLCAiZHZ2aWRlbyIsCiAg
ICAgeyJEVlNEIiwgIiJ9fSwKLSAge0NPREVDX0lEX1dNVjEsIFRDX0NPREVDX1dNVjEsICJ3bXYx
IiwKKyAge0FWX0NPREVDX0lEX1dNVjEsIFRDX0NPREVDX1dNVjEsICJ3bXYxIiwKICAgICB7IldN
VjEiLCAiIn19LAotICB7Q09ERUNfSURfV01WMiwgVENfQ09ERUNfV01WMiwgIndtdjIiLAorICB7
QVZfQ09ERUNfSURfV01WMiwgVENfQ09ERUNfV01WMiwgIndtdjIiLAogICAgIHsiV01WMiIsICIi
fX0sCi0gIHtDT0RFQ19JRF9IVUZGWVVWLCBUQ19DT0RFQ19IVUZGWVVWLCAiaGZ5dSIsCisgIHtB
Vl9DT0RFQ19JRF9IVUZGWVVWLCBUQ19DT0RFQ19IVUZGWVVWLCAiaGZ5dSIsCiAgICAgeyJIRllV
IiwgIiJ9fSwKLSAge0NPREVDX0lEX0gyNjNJLCBUQ19DT0RFQ19IMjYzSSwgImgyNjNpIiwKKyAg
e0FWX0NPREVDX0lEX0gyNjNJLCBUQ19DT0RFQ19IMjYzSSwgImgyNjNpIiwKICAgICB7IkkyNjMi
LCAiIn19LAotICB7Q09ERUNfSURfSDI2M1AsIFRDX0NPREVDX0gyNjNQLCAiaDI2M3AiLAorICB7
QVZfQ09ERUNfSURfSDI2M1AsIFRDX0NPREVDX0gyNjNQLCAiaDI2M3AiLAogICAgIHsiSDI2MyIs
ICJVMjYzIiwgIlZJVjEiLCAiIn19LAotICB7Q09ERUNfSURfSDI2NCwgVENfQ09ERUNfSDI2NCwg
ImgyNjQiLAorICB7QVZfQ09ERUNfSURfSDI2NCwgVENfQ09ERUNfSDI2NCwgImgyNjQiLAogICAg
IHsiSDI2NCIsICJoMjY0IiwgIlgyNjQiLCAieDI2NCIsICJhdmMxIiwgIiJ9fSwKLSAge0NPREVD
X0lEX1JWMTAsIFRDX0NPREVDX1JWMTAsICJydjEwIiwKKyAge0FWX0NPREVDX0lEX1JWMTAsIFRD
X0NPREVDX1JWMTAsICJydjEwIiwKICAgICB7IlJWMTAiLCAiUlYxMyIsICIifX0sCi0gIHtDT0RF
Q19JRF9TVlExLCBUQ19DT0RFQ19TVlExLCAic3ZxMSIsCisgIHtBVl9DT0RFQ19JRF9TVlExLCBU
Q19DT0RFQ19TVlExLCAic3ZxMSIsCiAgICAgeyJTVlExIiwgIiJ9fSwKLSAge0NPREVDX0lEX1NW
UTMsIFRDX0NPREVDX1NWUTMsICJzdnEzIiwKKyAge0FWX0NPREVDX0lEX1NWUTMsIFRDX0NPREVD
X1NWUTMsICJzdnEzIiwKICAgICB7IlNWUTMiLCAiIn19LAotICB7Q09ERUNfSURfTVBFRzJWSURF
TywgVENfQ09ERUNfTVBFRzIsICJtcGVnMnZpZGVvIiwKKyAge0FWX0NPREVDX0lEX01QRUcyVklE
RU8sIFRDX0NPREVDX01QRUcyLCAibXBlZzJ2aWRlbyIsCiAgICAgeyJNUEcyIiwgIiJ9fSwKLSAg
e0NPREVDX0lEX01QRUcyVklERU8sIFRDX0NPREVDX01QRUcsICJtcGVnMnZpZGVvIiwKKyAge0FW
X0NPREVDX0lEX01QRUcyVklERU8sIFRDX0NPREVDX01QRUcsICJtcGVnMnZpZGVvIiwKICAgICB7
Ik1QRzIiLCAiIn19LAotICB7Q09ERUNfSURfQVNWMSwgVENfQ09ERUNfQVNWMSwgImFzdjEiLAor
ICB7QVZfQ09ERUNfSURfQVNWMSwgVENfQ09ERUNfQVNWMSwgImFzdjEiLAogICAgIHsiQVNWMSIs
ICIifX0sCi0gIHtDT0RFQ19JRF9BU1YyLCBUQ19DT0RFQ19BU1YyLCAiYXN2MiIsCisgIHtBVl9D
T0RFQ19JRF9BU1YyLCBUQ19DT0RFQ19BU1YyLCAiYXN2MiIsCiAgICAgeyJBU1YyIiwgIiJ9fSwK
LSAge0NPREVDX0lEX0ZGVjEsIFRDX0NPREVDX0ZGVjEsICJmZnYxIiwKKyAge0FWX0NPREVDX0lE
X0ZGVjEsIFRDX0NPREVDX0ZGVjEsICJmZnYxIiwKICAgICB7IkZGVjEiLCAiIn19LAotICB7Q09E
RUNfSURfUkFXVklERU8sIFRDX0NPREVDX1lVVjQyMFAsICJyYXciLAorICB7QVZfQ09ERUNfSURf
UkFXVklERU8sIFRDX0NPREVDX1lVVjQyMFAsICJyYXciLAogICAgIHsiSTQyMCIsICJJWVVWIiwg
IiJ9fSwKLSAge0NPREVDX0lEX1JBV1ZJREVPLCBUQ19DT0RFQ19ZVVY0MjJQLCAicmF3IiwKKyAg
e0FWX0NPREVDX0lEX1JBV1ZJREVPLCBUQ19DT0RFQ19ZVVY0MjJQLCAicmF3IiwKICAgICB7Ilk0
MkIiLCAiIn19LAogICB7MCwgVENfQ09ERUNfVU5LTk9XTiwgTlVMTCwgeyIifX19OwogCkBAIC0z
MDIsNyArMzAyLDcgQEAKIAogICAgIC8vIFNldCB0aGVzZSB0byB0aGUgZXhwZWN0ZWQgdmFsdWVz
IHNvIHRoYXQgZmZtcGVnJ3MgZGVjb2RlciBjYW4KICAgICAvLyBwcm9wZXJseSBkZXRlY3QgaW50
ZXJsYWNlZCBpbnB1dC4KLSAgICBsYXZjX2RlY19jb250ZXh0ID0gYXZjb2RlY19hbGxvY19jb250
ZXh0KCk7CisgICAgbGF2Y19kZWNfY29udGV4dCA9IGF2Y29kZWNfYWxsb2NfY29udGV4dDMobGF2
Y19kZWNfY29kZWMpOwogICAgIGlmIChsYXZjX2RlY19jb250ZXh0ID09IE5VTEwpIHsKICAgICAg
IHRjX2xvZ19lcnJvcihNT0RfTkFNRSwgIkNvdWxkIG5vdCBhbGxvY2F0ZSBlbm91Z2ggbWVtb3J5
LiIpOwogICAgICAgcmV0dXJuIFRDX0lNUE9SVF9FUlJPUjsKQEAgLTMxNCw3ICszMTQsNyBAQAog
I2lmIExJQkFWQ09ERUNfVkVSU0lPTl9JTlQgPCAoKDUyPDwxNikrKDA8PDgpKzApCiAgICAgbGF2
Y19kZWNfY29udGV4dC0+ZXJyb3JfcmVzaWxpZW5jZSAgPSAyOwogI2Vsc2UKLSAgICBsYXZjX2Rl
Y19jb250ZXh0LT5lcnJvcl9yZWNvZ25pdGlvbiA9IDI7CisgICAgbGF2Y19kZWNfY29udGV4dC0+
ZXJyX3JlY29nbml0aW9uID0gMjsKICNlbmRpZgogICAgIGxhdmNfZGVjX2NvbnRleHQtPmVycm9y
X2NvbmNlYWxtZW50ID0gMzsKICAgICBsYXZjX2RlY19jb250ZXh0LT53b3JrYXJvdW5kX2J1Z3Mg
PSBGRl9CVUdfQVVUT0RFVEVDVDsKQEAgLTMyNCwxMyArMzI0LDEzIEBACiAgICAgLy8gWFhYOiBz
b21lIGNvZGVjcyBuZWVkIGV4dHJhIGRhdGEKICAgICBzd2l0Y2ggKGNvZGVjLT5pZCkKICAgICB7
Ci0gICAgICBjYXNlIENPREVDX0lEX01KUEVHOiBleHRyYV9kYXRhX3NpemUgID0gMjg7IGJyZWFr
OwotICAgICAgY2FzZSBDT0RFQ19JRF9MSlBFRzogZXh0cmFfZGF0YV9zaXplICA9IDI4OyBicmVh
azsKLSAgICAgIGNhc2UgQ09ERUNfSURfSFVGRllVVjogZXh0cmFfZGF0YV9zaXplID0gMTAwMDsg
YnJlYWs7Ci0gICAgICBjYXNlIENPREVDX0lEX0FTVjE6IGV4dHJhX2RhdGFfc2l6ZSA9IDg7IGJy
ZWFrOwotICAgICAgY2FzZSBDT0RFQ19JRF9BU1YyOiBleHRyYV9kYXRhX3NpemUgPSA4OyBicmVh
azsKLSAgICAgIGNhc2UgQ09ERUNfSURfV01WMTogZXh0cmFfZGF0YV9zaXplID0gNDsgYnJlYWs7
Ci0gICAgICBjYXNlIENPREVDX0lEX1dNVjI6IGV4dHJhX2RhdGFfc2l6ZSA9IDQ7IGJyZWFrOwor
ICAgICAgY2FzZSBBVl9DT0RFQ19JRF9NSlBFRzogZXh0cmFfZGF0YV9zaXplICA9IDI4OyBicmVh
azsKKyAgICAgIGNhc2UgQVZfQ09ERUNfSURfTEpQRUc6IGV4dHJhX2RhdGFfc2l6ZSAgPSAyODsg
YnJlYWs7CisgICAgICBjYXNlIEFWX0NPREVDX0lEX0hVRkZZVVY6IGV4dHJhX2RhdGFfc2l6ZSA9
IDEwMDA7IGJyZWFrOworICAgICAgY2FzZSBBVl9DT0RFQ19JRF9BU1YxOiBleHRyYV9kYXRhX3Np
emUgPSA4OyBicmVhazsKKyAgICAgIGNhc2UgQVZfQ09ERUNfSURfQVNWMjogZXh0cmFfZGF0YV9z
aXplID0gODsgYnJlYWs7CisgICAgICBjYXNlIEFWX0NPREVDX0lEX1dNVjE6IGV4dHJhX2RhdGFf
c2l6ZSA9IDQ7IGJyZWFrOworICAgICAgY2FzZSBBVl9DT0RFQ19JRF9XTVYyOiBleHRyYV9kYXRh
X3NpemUgPSA0OyBicmVhazsKICAgICAgIGRlZmF1bHQ6IGV4dHJhX2RhdGFfc2l6ZSA9IDA7IGJy
ZWFrOwogICAgIH0KIApAQCAtMzQ0LDcgKzM0NCw3IEBACiAgICAgfQogCiAgICAgVENfTE9DS19M
SUJBVkNPREVDOwotICAgIHJldCA9IGF2Y29kZWNfb3BlbihsYXZjX2RlY19jb250ZXh0LCBsYXZj
X2RlY19jb2RlYyk7CisgICAgcmV0ID0gYXZjb2RlY19vcGVuMihsYXZjX2RlY19jb250ZXh0LCBs
YXZjX2RlY19jb2RlYywgTlVMTCk7CiAgICAgVENfVU5MT0NLX0xJQkFWQ09ERUM7CiAgICAgaWYg
KHJldCA8IDApIHsKICAgICAgIHRjX2xvZ193YXJuKE1PRF9OQU1FLCAiQ291bGQgbm90IGluaXRp
YWxpemUgdGhlICclcycgY29kZWMuIiwKQEAgLTM2MCw3ICszNjAsNyBAQAogICAgICAgICBmcmFt
ZV9zaXplID0geF9kaW0qeV9kaW0gKyAyKlVWX1BMQU5FX1NJWkUoSU1HX1lVVl9ERUZBVUxULHhf
ZGltLHlfZGltKTsKIAogCS8vIHdlIGFkYXB0IHRoZSBjb2xvciBzcGFjZQotICAgICAgICBpZihj
b2RlYy0+aWQgPT0gQ09ERUNfSURfTUpQRUcpIHsKKyAgICAgICAgaWYoY29kZWMtPmlkID09IEFW
X0NPREVDX0lEX01KUEVHKSB7CiAJICBlbmFibGVfbGV2ZWxzX2ZpbHRlcigpOwogICAgICAgICB9
CiAgICAgICAgIGJyZWFrOwpAQCAtNDM0LDcgKzQzNCw3IEBACiAgICAgICB9CiAKICAgICAgIC8v
IHdlIGFkYXB0IHRoZSBjb2xvciBzcGFjZQotICAgICAgaWYoY29kZWMtPmlkID09IENPREVDX0lE
X01KUEVHKSB7CisgICAgICBpZihjb2RlYy0+aWQgPT0gQVZfQ09ERUNfSURfTUpQRUcpIHsKICAg
ICAgICAgZW5hYmxlX2xldmVsc19maWx0ZXIoKTsKICAgICAgIH0KIApAQCAtNTA0LDEzICs1MDQs
MTMgQEAKICAgICAgIGludCBia2V5ID0gMDsKIAogICAgICAgLy8gY2hlY2sgZm9yIGtleWZyYW1l
cwotICAgICAgaWYgKGNvZGVjLT5pZCA9PSBDT0RFQ19JRF9NU01QRUc0VjMpIHsKKyAgICAgIGlm
IChjb2RlYy0+aWQgPT0gQVZfQ09ERUNfSURfTVNNUEVHNFYzKSB7CiAJaWYgKGRpdngzX2lzX2tl
eShidWZmZXIpKSBia2V5ID0gMTsKICAgICAgIH0KLSAgICAgIGVsc2UgaWYgKGNvZGVjLT5pZCA9
PSBDT0RFQ19JRF9NUEVHNCkgeworICAgICAgZWxzZSBpZiAoY29kZWMtPmlkID09IEFWX0NPREVD
X0lEX01QRUc0KSB7CiAJaWYgKG1wZWc0X2lzX2tleShidWZmZXIsIGJ5dGVzX3JlYWQpKSBia2V5
ID0gMTsKICAgICAgIH0KLSAgICAgIGVsc2UgaWYgKGNvZGVjLT5pZCA9PSBDT0RFQ19JRF9NSlBF
RykgeworICAgICAgZWxzZSBpZiAoY29kZWMtPmlkID09IEFWX0NPREVDX0lEX01KUEVHKSB7CiAJ
YmtleSA9IDE7CiAgICAgICB9CiAKQEAgLTU4MCw4ICs1ODAsOCBAQAogCiAgICAgLy8gQ29udmVy
dCBhdmNvZGVjIGltYWdlIHRvIG91ciBpbnRlcm5hbCBZVVYgb3IgUkdCIGZvcm1hdAogICAgIHN3
aXRjaCAobGF2Y19kZWNfY29udGV4dC0+cGl4X2ZtdCkgewotICAgICAgY2FzZSBQSVhfRk1UX1lV
Vko0MjBQOgotICAgICAgY2FzZSBQSVhfRk1UX1lVVjQyMFA6CisgICAgICBjYXNlIEFWX1BJWF9G
TVRfWVVWSjQyMFA6CisgICAgICBjYXNlIEFWX1BJWF9GTVRfWVVWNDIwUDoKICAgICAgICAgc3Jj
X2ZtdCA9IElNR19ZVVY0MjBQOwogICAgICAgICBZVVZfSU5JVF9QTEFORVMoc3JjX3BsYW5lcywg
ZnJhbWUsIHNyY19mbXQsCiAgICAgICAgICAgICAgICAgICAgICAgICBsYXZjX2RlY19jb250ZXh0
LT53aWR0aCwgbGF2Y19kZWNfY29udGV4dC0+aGVpZ2h0KTsKQEAgLTYxMiw3ICs2MTIsNyBAQAog
CX0KICAgICAgICAgYnJlYWs7CiAKLSAgICAgIGNhc2UgUElYX0ZNVF9ZVVY0MTFQOgorICAgICAg
Y2FzZSBBVl9QSVhfRk1UX1lVVjQxMVA6CiAgICAgICAgIHNyY19mbXQgPSBJTUdfWVVWNDExUDsK
ICAgICAgICAgWVVWX0lOSVRfUExBTkVTKHNyY19wbGFuZXMsIGZyYW1lLCBzcmNfZm10LAogICAg
ICAgICAgICAgICAgICAgICAgICAgbGF2Y19kZWNfY29udGV4dC0+d2lkdGgsIGxhdmNfZGVjX2Nv
bnRleHQtPmhlaWdodCk7CkBAIC02NDAsOCArNjQwLDggQEAKICAgICAgICAgfQogICAgICAgICBi
cmVhazsKIAotICAgICAgY2FzZSBQSVhfRk1UX1lVVko0MjJQOgotICAgICAgY2FzZSBQSVhfRk1U
X1lVVjQyMlA6CisgICAgICBjYXNlIEFWX1BJWF9GTVRfWVVWSjQyMlA6CisgICAgICBjYXNlIEFW
X1BJWF9GTVRfWVVWNDIyUDoKICAgICAgICAgc3JjX2ZtdCA9IElNR19ZVVY0MjJQOwogICAgICAg
ICBZVVZfSU5JVF9QTEFORVMoc3JjX3BsYW5lcywgZnJhbWUsIHNyY19mbXQsCiAgICAgICAgICAg
ICAgICAgICAgICAgICBsYXZjX2RlY19jb250ZXh0LT53aWR0aCwgbGF2Y19kZWNfY29udGV4dC0+
aGVpZ2h0KTsKQEAgLTY2OSw4ICs2NjksOCBAQAogICAgICAgICB9CiAJYnJlYWs7CiAKLSAgICAg
IGNhc2UgUElYX0ZNVF9ZVVZKNDQ0UDoKLSAgICAgIGNhc2UgUElYX0ZNVF9ZVVY0NDRQOgorICAg
ICAgY2FzZSBBVl9QSVhfRk1UX1lVVko0NDRQOgorICAgICAgY2FzZSBBVl9QSVhfRk1UX1lVVjQ0
NFA6CiAgICAgICAgIHNyY19mbXQgPSBJTUdfWVVWNDQ0UDsKICAgICAgICAgWVVWX0lOSVRfUExB
TkVTKHNyY19wbGFuZXMsIGZyYW1lLCBzcmNfZm10LAogICAgICAgICAgICAgICAgICAgICAgICAg
bGF2Y19kZWNfY29udGV4dC0+d2lkdGgsIGxhdmNfZGVjX2NvbnRleHQtPmhlaWdodCk7Ci0tLSBh
L2ltcG9ydC9wcm9iZV9mZm1wZWcuYwkyMDExLTExLTE5IDE3OjUwOjI3LjAwMDAwMDAwMCArMDEw
MAorKysgYi9pbXBvcnQvcHJvYmVfZmZtcGVnLmMJMjAxNi0wMi0xNSAxNjowODozNy45MTc0ODgx
ODQgKzAxMDAKQEAgLTk5LDggKzk5LDggQEAKIAogICAgIFRDX0lOSVRfTElCQVZDT0RFQzsKIAot
ICAgIHJldCA9IGF2X29wZW5faW5wdXRfZmlsZSgmbGF2Zl9kbXhfY29udGV4dCwgaXBpcGUtPm5h
bWUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5VTEwsIDAsIE5VTEwpOworICAgIHJl
dCA9IGF2Zm9ybWF0X29wZW5faW5wdXQoJmxhdmZfZG14X2NvbnRleHQsIGlwaXBlLT5uYW1lLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOVUxMLCBOVUxMKTsKICAgICBpZiAocmV0ICE9
IDApIHsKICAgICAgICAgdGNfbG9nX2Vycm9yKF9fRklMRV9fLCAidW5hYmxlIHRvIG9wZW4gJyVz
JyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiIChsaWJhdmZvcm1hdCBmYWlsdXJl
KSIsCkBAIC0xMDksNyArMTA5LDcgQEAKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAgIHJl
dCA9IGF2X2ZpbmRfc3RyZWFtX2luZm8obGF2Zl9kbXhfY29udGV4dCk7CisgICAgcmV0ID0gYXZm
b3JtYXRfZmluZF9zdHJlYW1faW5mbyhsYXZmX2RteF9jb250ZXh0LCBOVUxMKTsKICAgICBpZiAo
cmV0IDwgMCkgewogICAgICAgICB0Y19sb2dfZXJyb3IoX19GSUxFX18sICJ1bmFibGUgdG8gZmV0
Y2ggaW5mb3JtYXRpb25zIGZyb20gJyVzJyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAiIChsaWJhdmZvcm1hdCBmYWlsdXJlKSIsCkBAIC0xMjAsNyArMTIwLDExIEBACiAKICAgICB0
cmFuc2xhdGVfaW5mbyhsYXZmX2RteF9jb250ZXh0LCBpcGlwZS0+cHJvYmVfaW5mbyk7CiAKKyNp
ZiBMSUJBVkZPUk1BVF9WRVJTSU9OX0lOVCA+IEFWX1ZFUlNJT05fSU5UKDUzLDI1LDApCisgICAg
YXZmb3JtYXRfY2xvc2VfaW5wdXQoJmxhdmZfZG14X2NvbnRleHQpOworI2Vsc2UKICAgICBhdl9j
bG9zZV9pbnB1dF9maWxlKGxhdmZfZG14X2NvbnRleHQpOworI2VuZGlmCiAgICAgcmV0dXJuOwog
fQogCi0tLSBhL2xpYnRjL3RjYXZjb2RlYy5oCTIwMTEtMTEtMTkgMTc6NTA6MjcuMDAwMDAwMDAw
ICswMTAwCisrKyBiL2xpYnRjL3RjYXZjb2RlYy5oCTIwMTYtMDItMTUgMTY6MDg6MzcuOTE3NDg4
MTg0ICswMTAwCkBAIC01Myw3ICs1Myw2IEBACiAKICNkZWZpbmUgVENfSU5JVF9MSUJBVkNPREVD
IGRvIHsgXAogICAgIFRDX0xPQ0tfTElCQVZDT0RFQzsgXAotICAgIGF2Y29kZWNfaW5pdCgpOyBc
CiAgICAgYXZjb2RlY19yZWdpc3Rlcl9hbGwoKTsgXAogICAgIFRDX1VOTE9DS19MSUJBVkNPREVD
OyBcCiB9IHdoaWxlICgwKQo=
" | base64 -d > $TMP/transcode-1.1.7-ffmpeg3-1.patch
patch -p1 -i $TMP/transcode-1.1.7-ffmpeg3-1.patch || exit 1

echo 
echo "$VERDE"Configurando paquete ..."$CIERRE"
sleep 1

CFLAGS="$SLKCFLAGS" \
CXXFLAGS="$SLKCFLAGS" \
LDFLAGS="-L/usr/lib${LIBDIRSUFFIX}" \
./configure \
  --prefix=/usr \
  --libdir=/usr/lib${LIBDIRSUFFIX} \
  --sysconfdir=/etc \
  --localstatedir=/var \
  --docdir=/usr/doc/$PRGNAM-$VERSION \
  --mandir=/usr/man \
  --enable-alsa \
  --enable-v4l \
  --enable-libv4l2=yes \
  --enable-libv4lconvert=yes \
  --enable-libmpeg2=yes \
  --enable-libmpeg2convert=yes \
  --enable-ogg \
  --enable-vorbis \
  --enable-theora \
  --enable-x264=yes \
  --enable-xvid=yes \
  --enable-faac=yes \
  --enable-freetype2 \
  --enable-sdl \
  --enable-libxml2 \
  --enable-libdv=yes \
  --enable-libquicktime=yes \
  --enable-mjpegtools=yes \
  --enable-a52=yes \
  --enable-lame=yes \
  --enable-nuv \
  --enable-lzo \
  --enable-libpostproc \
  --enable-imagemagick \
  --build=$ARCH-slackware-linux
  
echo 
echo "$VERDE"Compilando paquete ..."$CIERRE"
sleep 1

make  || exit 1
make DESTDIR=$PKG install || exit 1

# Install headers
mkdir -p $PKG/usr/include/transcode/{aclib,avilib,libtc,libtcaudio,libtcvideo}
install -m 644 src/*.h $PKG/usr/include/transcode/
install -m 644 aclib/*.h $PKG/usr/include/transcode/aclib/
install -m 644 avilib/*.h $PKG/usr/include/transcode/avilib/
install -m 644 libtc/*.h $PKG/usr/include/transcode/libtc/
install -m 644 libtcaudio/*.h $PKG/usr/include/transcode/libtcaudio/
install -m 644 libtcvideo/*.h $PKG/usr/include/transcode/libtcvideo/
install -m 644 config.h $PKG/usr/include/transcode/

# remove filters shipped by other packages
rm -f $PKG/usr/lib$LIBDIRSUFFIX/transcode/filter_{stabilize,transform}.*

# Hay un bug que no respeta el docdir y lo eliminamos a mano
if [ -d $PKG/usr/share/doc ]; then
rm -rf $PKG/usr/share/doc
fi
}

###################################
## BLOQUE PRINCIPAL DE EJECUCION ##
###################################
# Si se cierra el script inesperadamente, ejecutar la funcion de limpieza
trap f_exitmode SIGHUP SIGINT

#Inicializamos las variables globales
f_variables
#Comprobamos conexion a Internet
f_comprobarConexion
#Inicializamos las variables del script
F_variables
#Creamos directorio de trabajo
f_directorioTemporal
#Mostramos el mensaje de presentacion
f_presentacion
#Comprobamos updates del script
f_comprobarUpdates
#Asignamos o detectamos arquitectura
f_arquitectura
#Comprobamos version instalada del paquete
f_versionInstalada
# Comprobar dependencias
F_dependencias
#Si no existe el fichero se descargara
f_download
#Preparando entorno
f_preparar
#Descomprimir fichero descargado y compilamos
F_compilar
#Hacemos strip sobre el paquete
f_strip
#Creamos xzm , instalamos y salimos
f_tareasFinales